var Lassalle={Flow:function(t){var e,i,n,o,s,l,h,r,a,d,f,u,p,c,g,x,y,S,v,b,w,M,k,m,L,A,z,P,H,C,O,D,I,j,T,W,F,N,G,R,Z,V,Y,X,_,E,B,q,U,K,Q,J,$,tt,et,it,nt,ot,st,lt,ht,rt,at,dt,ft,ut,ct,gt,xt,yt,St,vt,bt,wt,Mt,kt,mt,Lt,At,zt,Pt,Ht,Ct;function Ot(t){var e,i,n,o,s,l,h,r,a;for(s=null,l=[],h=function(t,e){this.offset=t,this.ba=e},r=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},a=function(){return l.length<2?0:l[l.length-1].offset},e=0;e<t.length;e++)i=t[e],0===l.length?l.push(new h(0,i)):(o=r(i,(n=l[l.length-1]).ba),l.push(new h(n.offset+o,i)));this.jA=function(t){var e,i,n,o,h,r,d,f,u,p,c,g,x,y;if(t<0||t>1||0===a())return null;for(i=t*a(),n=0,o=l.length-1;o-n>1;)h=Math.floor((o+n)/2),i<l[h].offset?o=h:n=h;return e={x:(((c=(d=l[o]).offset)-i)*(f=(r=l[n]).ba).x+(i-(p=r.offset))*(u=d.ba).x)/(c-p),y:((c-i)*f.y+(i-p)*u.y)/(c-p)},g=u.x-f.x,x=u.y-f.y,y=Math.sqrt(Math.pow(g,2)+Math.pow(x,2)),s={x:g/y,y:x/y},e},this.jZ=function(){return s}}(xt=function(t,e,i,n){this.left=t,this.top=e,this.width=i,this.height=n}).prototype.gw=function(){return new xt(this.left,this.top,this.width,this.height)},xt.prototype.jp=function(t){return this.left===t.left&&this.top===t.top&&this.width===t.width&&this.height===t.height},xt.prototype.fb=function(t){return this.left<t.left+t.width&&this.left+this.width>t.left&&this.top<t.top+t.height&&this.top+this.height>t.top},xt.prototype.bH=function(t,e){return new xt(this.left-t,this.top-e,this.width+2*t,this.height+2*e)},xt.prototype.offset=function(t,e){return new xt(this.left+t,this.top+e,this.width,this.height)},xt.prototype.jJ=function(t){var e=this.gw();return e.bI(t),e},xt.prototype.bI=function(t){var e,i;e=Math.max(this.left+this.width,t.left+t.width),i=Math.max(this.top+this.height,t.top+t.height),this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.width=e-this.left,this.height=i-this.top},xt.prototype.af=function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},xt.prototype.bf=function(t){return t.x>=this.left&&t.x<=this.left+this.width&&t.y>=this.top&&t.y<=this.top+this.height},xt.prototype.lK=function(t){return t.left>=this.left&&t.left+t.width<=this.left+this.width&&t.top>=this.top&&t.top+t.height<=this.top+this.height},yt={lz:function(t,e,i,n,o){t.beginPath(),t.moveTo(e.x,e.y),t.bezierCurveTo(i.x,i.y,n.x,n.y,o.x,o.y)},io:function(t,e){var i;for(t.beginPath(),t.moveTo(e[0].x,e[0].y),i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y)},kw:function(t,e,i){var n,o,s,l;for(l=e.length,t.beginPath(),t.moveTo(e[0].x,e[0].y),n=0;n<l-2;n++)o=yt.jK(e,n,i),s=yt.kS(e,n,i),0===o.x&&0===o.y||0===s.x&&0===s.y?t.lineTo(e[n+1].x,e[n+1].y):(t.lineTo(o.x,o.y),t.bezierCurveTo(e[n+1].x,e[n+1].y,e[n+1].x,e[n+1].y,s.x,s.y));t.lineTo(e[l-1].x,e[l-1].y)},eg:function(t,e,i,n,o){var s,l,h,r,a,d;s=n/2*.5522848,l=o/2*.5522848,h=e+n,r=i+o,a=e+n/2,d=i+o/2,t.beginPath(),t.moveTo(e,d),t.bezierCurveTo(e,d-l,a-s,i,a,i),t.bezierCurveTo(a+s,i,h,d-l,h,d),t.bezierCurveTo(h,d+l,a+s,r,a,r),t.bezierCurveTo(a-s,r,e,d+l,e,d),t.closePath()},cK:function(t,e,i,n,o){t.beginPath(),t.moveTo(e,i),t.lineTo(e+n,i),t.lineTo(e+n,i+o),t.lineTo(e,i+o),t.closePath()},hM:function(t,e){var i;for(t.beginPath(),t.moveTo(e[0].x,e[0].y),i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath()},fV:function(t,e,i,n,o,s,l){var h,r,a,d,f,u,p,c,g,x;for(c=0,x=0,h=(e=e.replace(/(\r\n|\n\r|\r|\n)/g,"\n")).split("\n"),u=function(e){l&&t.fillText(e,i,n+o*c),c++,(d=t.measureText(e).width)>x&&(x=d)},r=0;r<h.length;r++){for(f=h[r].split(" "),p=1;f.length>0&&p<=f.length;)a=f.slice(0,p).join(" "),(d=t.measureText(a).width)>s?(1===p?(a=f.slice(0,1).join(" "),f=f.splice(1)):(a=f.slice(0,p-1).join(" "),f=f.splice(p-1)),u(a),p=1):p++;p>0&&u(f.join(" "))}if(g=o*c+.25*o*(c-1),!l)return{height:g,width:x}},jE:function(t,e,i,n){var o;return{x:(1-(o=18/19))*(1-o)*(1-o)*t.x+3*o*(1-o)*(1-o)*e.x+3*o*o*(1-o)*i.x+o*o*o*n.x,y:(1-o)*(1-o)*(1-o)*t.y+3*o*(1-o)*(1-o)*e.y+3*o*o*(1-o)*i.y+o*o*o*n.y}},hY:function(t,e){var i;for(i in t.beginPath(),t.moveTo(e[0][0],e[0][1]),e)i>0&&t.lineTo(e[i][0],e[i][1]);t.lineTo(e[0][0],e[0][1]),t.fill(),t.stroke()},ir:function(t,e,i){var n,o;for(n in o=[],t)o.push([t[n][0]+e,t[n][1]+i]);return o},gM:function(t,e){var i,n;for(i in n=[],t)n.push(yt.iZ(e,t[i][0],t[i][1]));return n},iZ:function(t,e,i){return[e*Math.cos(t)-i*Math.sin(t),e*Math.sin(t)+i*Math.cos(t)]},kZ:function(t,e){var i,n;if(2===(n=t.length))e.push(t[0]),e.push(t[1]);else if(3===n)yt.fr(e,t[0],t[0],t[1],t[2]),yt.fr(e,t[0],t[1],t[2],t[2]);else{for(yt.fr(e,t[0],t[0],t[1],t[2]),i=0;i<n-3;i++)yt.fr(e,t[i],t[i+1],t[i+2],t[i+3]);yt.fr(e,t[n-3],t[n-2],t[n-1],t[n-1])}},fr:function(t,e,i,n,o){var s,l,h=.5*(n.x-e.x),r=.5*(n.y-e.y),a=.5*(o.x-i.x),d=.5*(o.y-i.y),f=h+a+2*i.x-2*n.x,u=r+d+2*i.y-2*n.y,p=-2*h-a-3*i.x+3*n.x,c=-2*r-d-3*i.y+3*n.y,g=h,x=r,y=i.x,S=i.y;for(s=0;s<10;s++)t.push({x:f*(l=s/9)*l*l+p*l*l+g*l+y,y:u*l*l*l+c*l*l+x*l+S})},du:function(t,e,i){var n,o,s,l;return s=Math.round(t.x),l=Math.round(t.y),e=Math.round(e),i=Math.round(i),e>0&&((n=s%e)<e/2?s-=n:s+=e-n),i>0&&((o=l%i)<i/2?l-=o:l+=i-o),{x:s,y:l}},gY:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},aV:function(t,e){return new xt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.abs(e.x-t.x),Math.abs(e.y-t.y))},ia:function(t,e,i,n){var o,s,l,h,r,a,d,f,u,p;return f=t.height/2,0==(d=t.width/2)||0===f?i:(l=n*(Math.PI/180),e.x-=i.x,e.y-=i.y,0!==l&&(s=e.y,e.x=(o=e.x)*Math.cos(l)+s*Math.sin(l),e.y=o*Math.sin(l)-s*Math.cos(l)),h=Math.atan2(e.y,-e.x),r=d*Math.sin(h),a=f*Math.cos(h),p={x:-(u=d*f/Math.sqrt(Math.pow(r,2)+Math.pow(a,2)))*Math.cos(h),y:u*Math.sin(h)},0!==l&&(s=p.y,p.x=(o=p.x)*Math.cos(l)+s*Math.sin(l),p.y=o*Math.sin(l)-s*Math.cos(l)),e.x+=i.x,e.y+=i.y,p.x+=i.x,p.y+=i.y,p)},fm:function(t,e,i){var n,o,s,l,h,r,a,d,f,u,p,c;for(u={x:0,y:0},p=0,c=t.length,n=0;n<c;n++){if(l={x:0,y:0},h=t[n],r=n<c-1?t[n+1]:t[0],Math.abs(h.x-r.x)<1e-4){if(Math.abs(i.x-e.x)<1e-4)continue;o=(e.y-i.y)/(e.x-i.x),l.x=h.x,l.y=o*(h.x-i.x)+i.y}else if(s=(r.y-h.y)/(r.x-h.x),Math.abs(i.x-e.x)<1e-4)l.x=e.x,l.y=s*(e.x-r.x)+r.y;else{if(o=(e.y-i.y)/(e.x-i.x),Math.abs(o-s)<1e-4)continue;l.x=-(r.y-s*r.x-i.y+o*i.x)/(s-o),l.y=o*(l.x-i.x)+i.y}(a=yt.aV(h,r)).left-=1,a.top-=1,a.width+=2,a.height+=2,a.bf(l)&&(d=l.y-e.y,f=Math.pow(l.x-e.x,2)+Math.pow(d,2),(0===p||f<p)&&(p=f,u=l))}return u},hU:function(t,e){return e.push({x:t.left,y:t.top}),e.push({x:t.left+t.width,y:t.top}),e.push({x:t.left+t.width,y:t.top+t.height}),e.push({x:t.left,y:t.top+t.height}),4},kV:function(t,e,i,n){var o,s,l;for(o=1e8,s=n/2,l=0;l<e-1;l++){if(0===l||l===e-2)if(t[l].x===t[l+1].x){if(i.y<Math.min(t[l].y,t[l+1].y)||i.y>Math.max(t[l].y,t[l+1].y))continue}else if(t[l].y===t[l+1].y){if(i.x<Math.min(t[l].x,t[l+1].x)||i.x>Math.max(t[l].x,t[l+1].x))continue}else if(!yt.aV(t[l],t[l+1]).bH(s,s).bf(i))continue;o=Math.min(o,yt.hk(t[l],t[l+1],i))}return o},hk:function(t,e,i){var n,o,s,l,h,r,a,d,f,u,p,c,g;return o=t.x-i.x,s=t.y-i.y,l=e.x-i.x,h=e.y-i.y,r=e.x-t.x,a=e.y-t.y,d=Math.pow(r,2)+Math.pow(a,2),f=Math.pow(o,2)+Math.pow(s,2),u=Math.pow(l,2)+Math.pow(h,2),(p=Math.sqrt(d))<1?n=Math.sqrt(f):(n=Math.abs(a*o-r*s)/p,((c={x:i.x-n*a/p,y:i.y+n*r/p}).x-(g={x:(e.x+t.x)/2,y:(e.y+t.y)/2}).x)*(c.x-g.x)+(c.y-g.y)*(c.y-g.y)>d/4&&(n=Math.sqrt(Math.min(f,u))),n)},jK:function(t,e,i){var n,o,s,l;return l={x:0,y:0},n=t[e+1].x-t[e].x,o=t[e].y-t[e+1].y,(s=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)))>0&&(l={x:t[e+1].x-i*(n/s),y:t[e+1].y+i*(o/s)}),l},kS:function(t,e,i){var n,o,s,l;return l={x:0,y:0},n=t[e+2].x-t[e+1].x,o=t[e+1].y-t[e+2].y,(s=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)))>0?{x:t[e+1].x+i*(n/s),y:t[e+1].y-i*(o/s)}:l},hb:function(t,e,i,n,o){var s;for(s=0;s<1;s+=.1)o.push({x:(1-s)*(1-s)*(1-s)*t.x+3*s*(1-s)*(1-s)*e.x+3*s*s*(1-s)*i.x+s*s*s*n.x,y:(1-s)*(1-s)*(1-s)*t.y+3*s*(1-s)*(1-s)*e.y+3*s*s*(1-s)*i.y+s*s*s*n.y});o.push(n)},dH:function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},kj:function(t){var e,i,n,o,s;if(0===t.length)return null;for(i=e=t[0][0],o=n=t[0][1],s=0;s<t.length;s++)e=Math.min(e,t[s][0]),n=Math.min(n,t[s][1]),i=Math.max(i,t[s][0]),o=Math.max(o,t[s][1]);return new xt(e,n,i-e,o-n)}};var Dt={};function It(t){var e;(e=document.createEvent("Event")).initEvent("context",!0,!0),e.item=t,document.dispatchEvent(e)}function jt(){var t,i;for((o=Dt.dU(0,0,k.width,k.height)).ft(),t=0;t<n.length;t++)(i=n[t]).fd=e.isNode(i)?Et(i):re(i),o.cs(i,i.fd)}function Tt(t){return t instanceof St}function Wt(t){return t instanceof vt}function Ft(t,s,l,h,r){var a,d=new St(t,s,l,h,r);return n.push(d),d.index=e.getItems().length-1,d.flow=e,void 0!==e.nodeModel&&null!==e.nodeModel&&ve(d,e.nodeModel),0===$&&(Ue(a=Et(d)),d.fd=a,cA&&o.cs(d,d.fd),d.refresh()),i.aL()&&i.bG(new Mt(e,d)),d}function Nt(t){var n,s,l;if(void 0!==t&&null!==t){for(n=!1,i.aL()&&((n=i.fq())||i.dN("AF_nodeRemove")),t.getIsSelected()&&t.setIsSelected(!1),l=(s=t.getLinks()).length-1;l>=0;l--)Rt(s[l]);i.aL()&&i.bG(new kt(e,t)),cA&&o.dS(t),Vt(t.index),e.refresh(),i.aL()&&(n||i.cV())}}function Gt(t,s,l,h,r){var a;return void 0===t||void 0===s?null:null===t||null===s?null:(a=new vt(t,s,l,h,r),n.push(a),t.getLinks().push(a),s.getLinks().push(a),a.flow=e,void 0!==e.linkModel&&null!==e.linkModel&&be(a,e.linkModel),ae(a),a.index=e.getItems().length-1,0===$&&(mA=re(a),Ue(mA),a.fd=mA,cA&&o.cs(a,a.fd),a.refresh()),i.aL()&&i.bG(new mt(e,a)),a)}function Rt(t){var n;void 0!==t&&null!==t&&(t.getIsSelected()&&t.setIsSelected(!1),n=!1,i.aL()&&((n=i.fq())||i.dN("AF_linkRemove")),t.setOrg(null),t.setDst(null),i.aL()&&i.bG(new Lt(e,t)),cA&&o.dS(t),Vt(t.index),e.refresh(),i.aL()&&(n||i.cV()))}function Zt(){var t,i;for(Z=!0,t=s.length-1;t>=0;t--)(i=s[t]).getIsSelected()&&i.setIsSelected(!1);s=[],Z=!1,e.refresh()}function Vt(t){var i;if(t>=0&&t<n.length)for(e.isNode(n[t])?Bt(n[t]):e.isLink(n[t])&&ie(n[t]),n.splice(t,1),i=t;i<n.length;i++)n[i].index=i}function Yt(t){var i,n;return i=Et(t),new xt(i.left+i.width-(n=e.contextHandleSize),i.top+1-n,n,2*e.contextHandleSize/5)}function Xt(t){var i,n,o,s,l;return l=[],"bezier"===t.lineStyle?yt.hb(t.points[0],t.points[1],t.points[2],t.points[3],l):l=t.points,dM=new Ot(l),pt=dM.jA(.5),null!==pt?(o=e.contextHandleSize,s=2*e.contextHandleSize/5,i=pt.x-o/2-20,n=pt.y-s/2-20,new xt(i,n,o,s)):null}function _t(t,i){var n,o,s,l;o=1*e.handleSize,s=e.handleSize,l=(l=Et(t)).bH(o,o),i.push(new xt((n={x:l.left,y:l.top}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left+l.width/2,y:l.top}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left+l.width,y:l.top}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left,y:l.top+l.height/2}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left+l.width,y:l.top+l.height/2}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left,y:l.top+l.height}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left+l.width/2,y:l.top+l.height}).x-s/2,n.y-s/2,s,s)),i.push(new xt((n={x:l.left+l.width,y:l.top+l.height}).x-s/2,n.y-s/2,s,s))}function Et(t){return new xt(t.x,t.y,t.w,t.h)}function Bt(t){ke(Re(t))}function qt(t,n){var o,s;o=!1,i.aL()&&((o=i.fq())||i.dN("AF_nodeMoveAndSize")),i.aL()&&(s=Et(t),i.bG(new wt(e,t,s))),Bt(t),t.x=n.left,t.y=n.top,t.w=n.width,t.h=n.height,te(t),t.refresh(),i.aL()&&(o||i.cV())}function Ut(t){return"ellipse"===t.shapeFamily}function Kt(t){return"rectangle"===t.shapeFamily}function Qt(t){return"polygon"===t.shapeFamily}function Jt(t,e){var i,n,o,s,l,h,r;if(void 0!==t.polygon&&null!==t.polygon){if(null===(i=yt.kj(t.polygon)))return;if(n=i.left,o=i.top,l=i.height,0===(s=i.width)||0===l)return;for(r=0;r<t.polygon.length;r++)h=Et(t),e.push({x:h.left+h.width/s*(t.polygon[r][0]-n),y:h.top+h.height/l*(t.polygon[r][1]-o)})}}function $t(t){return t.getLinks()}function te(t){var e,i,n;for(i=$t(t),e=0;e<i.length;e++)n=i[e],cA&&o.dS(n),se(n),n.fd=re(n),cA&&o.cs(n,n.fd)}function ee(t,e){var i,n,o,s;for(s=!1,o=$t(t),i=0;i<o.length;i++)if((n=o[i]).dst===e&&n.org===t){s=!0;break}return s}function ie(t){ke(Ze(t))}function ne(t){return t.org===t.dst}function oe(t){return"polyline"===t.getLineStyle()||"spline"===t.getLineStyle()}function se(t){ie(t),"database"===t.getLineStyle()?de(t):"orthogonal"===t.getLineStyle()&&fe(t),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),ie(t)}function le(t,n){var o;o=t.pinOrg,t.pinOrg=n,ie(t),null!==t.org.pins&&t.pinOrg>=0&&t.pinOrg<t.org.pins.length&&(i.aL()&&i.submitTask(new mW(e,t,o)),null!==t.points&&t.points.length>0&&(t.points[0]=Te(t.org,t.pinOrg),"database"===t.getLineStyle()?de(t):"orthogonal"===t.getLineStyle()&&fe(t),t.refresh()))}function he(t,n){var o;o=t.pinDst,t.pinDst=n,ie(t),null!==t.dst.pins&&t.pinDst>=0&&t.pinDst<t.dst.pins.length&&(i.aL()&&i.submitTask(new mL(e,t,o)),null!==t.points&&t.points.length>0&&(t.points[t.points.length-1]=Te(t.dst,t.pinDst),"database"===t.getLineStyle()?de(t):"orthogonal"===t.getLineStyle()&&fe(t),t.refresh()))}function re(t){var e,i,n,o,s,l,h,r;if(r=[],"bezier"===t.getLineStyle()){for(yt.hb(t.points[0],t.points[1],t.points[2],t.points[3],r),e=new xt(r[0].x,r[0].y,0,0),n=0;n<r.length-1;n++)e.bI(yt.aV(r[n],r[n+1]));if(t.getIsSelected())for(n=0;n<t.points.length-1;n++)e.bI(yt.aV(t.points[n],t.points[n+1]))}else for(e=new xt((r=t.points)[0].x,r[0].y,0,0),n=0;n<r.length-1;n++)e.bI(yt.aV(r[n],r[n+1]));return null!==t.text&&t.text.length>0&&null!==(o=new Ot(r).jA(.5))&&((s=t.flow.canvas.getContext("2d")).font=t.font,l=s.measureText(t.text).width,void 0===(h=1.2*parseInt(t.font,10))&&(h=16),(i=new xt(o.x-l/2,o.y-h/2,l,h)).bH(h/2,h/2),e.bI(i)),e.bH(t.flow.linkSelectionAreaWidth,t.flow.linkSelectionAreaWidth)}function ae(t){t.points.splice(0,t.points.length),"orthogonal"===t.getLineStyle()?function(t){t.points=gt.lh(t.org,t.dst,t.pinOrg,t.pinDst,t.orthoMargin),t.ij=t.points[0].y===t.points[1].y}(t):"database"===t.getLineStyle()?function(t){var e,i,n;for(e=0;e<4;e++)t.points.push({x:0,y:0});i=Et(t.org),n=Et(t.dst),i.left+i.width/2<n.left+n.width/2?(t.points[0]=Se(t)?ge(t):{x:i.left+i.width,y:i.top+i.height/2},t.points[3]=ye(t)?xe(t):{x:n.left,y:n.top+n.height/2},t.points[1]={x:Math.max(t.points[0].x+R,0),y:t.points[0].y},t.points[2]={x:Math.max(t.points[3].x-R,0),y:t.points[3].y}):(t.points[0]=Se(t)?ge(t):{x:i.left,y:i.top+i.height/2},t.points[3]=ye(t)?xe(t):{x:n.left+n.width,y:n.top+n.height/2},t.points[1]={x:Math.max(t.points[0].x-R,0),y:t.points[0].y},t.points[2]={x:Math.max(t.points[3].x+R,0),y:t.points[3].y})}(t):"bezier"===t.getLineStyle()?function(t){var e,i,n,o,s,l,h,r;t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),ne(t)?(t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),r=Et(t.org),t.points[0]=r.af(),t.points[1]={x:r.left+r.width+r.width/2,y:t.points[1].y},t.points[2]={x:r.left+r.width/2,y:t.points[2].y},r.top-r.height>=0?(t.points[1]={x:t.points[1].x,y:r.top-r.height/2},t.points[2]={x:t.points[2].x,y:r.top-r.height}):(t.points[1]={x:t.points[1].x,y:r.top+r.height+r.height/2},t.points[2]={x:t.points[2].x,y:r.top+r.height+r.height}),t.points[3]=t.points[0],Se(t)?t.points[0]=ge(t):pe(t),ye(t)?t.points[t.points.length-1]=xe(t):ue(t)):(Se(t)?t.points[0]=ge(t):pe(t),ye(t)?t.points[t.points.length-1]=xe(t):ue(t),n=(i=t.points[1]).x-(e=t.points[0]).x,o=i.y-e.y,s=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),l={x:e.x+n/2-s/5,y:e.y+o/2-s/5},h={x:e.x+n/2+s/5,y:e.y+o/2+s/5},t.points.splice(0,t.points.length),t.points.push(e),t.points.push(l),t.points.push(h),t.points.push(i),Se(t)||pe(t),ye(t)||ue(t))}(t):function(t){var e;t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),ne(t)?(t.points.push({x:0,y:0}),t.points.push({x:0,y:0}),e=Et(t.org),t.points[0]=e.af(),t.points[1]={x:e.left+e.width+e.width/2,y:t.points[1].y},t.points[2]={x:e.left+e.width/2,y:t.points[2].y},e.top-e.height>=0?(t.points[1]={x:t.points[1].x,y:e.top-e.height/2},t.points[2]={x:t.points[2].x,y:e.top-e.height}):(t.points[1]={x:t.points[1].x,y:e.top+e.height+e.height/2},t.points[2]={x:t.points[2].x,y:e.top+e.height+e.height}),t.points[3]=t.points[0],pe(t),ue(t)):(Se(t)?t.points[0]=ge(t):pe(t),ye(t)?t.points[t.points.length-1]=xe(t):ue(t))}(t)}function de(t){var e,i;e=null!==t.org.pins||t.isOrgPointAdjustable?t.points[0]:Et(t.org).af(),i=null!==t.dst.pins||t.isDstPointAdjustable?t.points[3]:Et(t.dst).af(),t.points[1]={x:t.points[0].x+R,y:e.y},t.points[2]={x:t.points[3].x-R,y:i.y}}function fe(t){var e,i,n;e=t.points.length,null!==t.org.pins&&void 0!==t.pinOrg&&(t.points[0]=Te(t.org,t.pinOrg)),null!==t.dst.pins&&void 0!==t.pinDst&&(t.points[e-1]=Te(t.dst,t.pinDst)),i=null!==t.org.pins||t.isOrgPointAdjustable?t.points[0]:Et(t.org).af(),n=null!==t.dst.pins||t.isDstPointAdjustable?t.points[e-1]:Et(t.dst).af(),t.ij?(t.points[1]={x:t.points[1].x,y:i.y},t.points[e-2]=e%2==0?{x:t.points[e-2].x,y:n.y}:{x:n.x,y:t.points[e-2].y}):(t.points[1]={x:i.x,y:t.points[1].y},t.points[e-2]=e%2==0?{x:n.x,y:t.points[e-2].y}:{x:t.points[e-2].x,y:n.y})}function ue(t){var e,i,n,o,s,l,h;e=Et(t.org),i=Et(t.dst),n=e.af(),o=i.af(),l=t.points.length,0!==i.width&&0!==i.height?(s=2===l?Se(t)?ge(t):n:t.points[l-2],Ut(t.dst)?t.points[l-1]=yt.ia(i,s,o,0):Qt(t.dst)&&null!==t.dst.polygon?(Jt(t.dst,h=[]),t.points[l-1]=yt.fm(h,s,o)):(yt.hU(i,h=[]),t.points[l-1]=yt.fm(h,s,o))):t.points[l-1]=o}function pe(t){var e,i,n,o,s,l;e=Et(t.org),i=Et(t.dst),n=e.af(),o=i.af(),0!==e.width&&0!==e.height?(s=2===t.points.length?ye(t)?xe(t):o:t.points[1],Ut(t.org)?t.points[0]=yt.ia(e,s,n,0):Qt(t.org)&&null!==t.org.polygon?(Jt(t.org,l=[]),t.points[0]=yt.fm(l,s,n)):(yt.hU(e,l=[]),t.points[0]=yt.fm(l,s,n))):t.points[0]=n}function ce(t){var e;for(t.kD=[t.points.length],e=0;e<t.points.length;e++)t.kD[e]=t.points[e]}function ge(t){var e;return{x:(e=Et(t.org)).left+e.width/100*t.org.pins[t.pinOrg][0],y:e.top+e.height/100*t.org.pins[t.pinOrg][1]}}function xe(t){var e;return{x:(e=Et(t.dst)).left+e.width/100*t.dst.pins[t.pinDst][0],y:e.top+e.height/100*t.dst.pins[t.pinDst][1]}}function ye(t){return null!==t.pinDst&&null!==t.dst.pins&&t.pinDst>=0&&t.pinDst<t.dst.pins.length}function Se(t){return null!==t.pinOrg&&null!==t.org.pins&&t.pinOrg>=0&&t.pinOrg<t.org.pins.length}function ve(t,e){void 0!==e.strokeStyle&&(t.strokeStyle=e.strokeStyle),void 0!==e.fillStyle&&(t.fillStyle=e.fillStyle),void 0!==e.gradientFillStyle&&(t.gradientFillStyle=e.gradientFillStyle),void 0!==e.textFillStyle&&(t.textFillStyle=e.textFillStyle),void 0!==e.lineWidth&&(t.lineWidth=e.lineWidth),void 0!==e.shapeFamily&&(t.shapeFamily=e.shapeFamily),void 0!==e.polygon&&(t.polygon=e.polygon),void 0!==e.drawShape&&(t.drawShape=e.drawShape),void 0!==e.fillShape&&(t.fillShape=e.fillShape),void 0!==e.pins&&(t.pins=e.pins),void 0!==e.isContextHandle&&(t.isContextHandle=e.isContextHandle),void 0!==e.isXSizeable&&(t.isXSizeable=e.isXSizeable),void 0!==e.isYSizeable&&(t.isYSizeable=e.isYSizeable),void 0!==e.isXMoveable&&(t.isXMoveable=e.isXMoveable),void 0!==e.isYMoveable&&(t.isYMoveable=e.isYMoveable),void 0!==e.isOutLinkable&&(t.isOutLinkable=e.isOutLinkable),void 0!==e.isInLinkable&&(t.isInLinkable=e.isInLinkable),void 0!==e.isSelectable&&(t.isSelectable=e.isSelectable),void 0!==e.isShadowed&&(t.isShadowed=e.isShadowed),void 0!==e.image&&(t.image=e.image),void 0!==e.textMargin&&(t.textMargin=e.textMargin),void 0!==e.imageMargin&&(t.imageMargin=e.imageMargin),void 0!==e.textPosition&&(t.textPosition=e.textPosition),void 0!==e.imagePosition&&(t.imagePosition=e.imagePosition),void 0!==e.font&&(t.font=e.font),void 0!==e.textLineHeight&&(t.textLineHeight=e.textLineHeight)}function be(t,e){void 0!==e.strokeStyle&&(t.strokeStyle=e.strokeStyle),void 0!==e.fillStyle&&(t.fillStyle=e.fillStyle),void 0!==e.textFillStyle&&(t.textFillStyle=e.textFillStyle),void 0!==e.lineWidth&&(t.lineWidth=e.lineWidth),void 0!==e.isStretchable&&(t.isStretchable=e.isStretchable),void 0!==e.isSelectable&&(t.isSelectable=e.isSelectable),void 0!==e.isContextHandle&&(t.isContextHandle=e.isContextHandle),void 0!==e.isShadowed&&(t.isShadowed=e.isShadowed),void 0!==e.font&&(t.font=e.font),void 0!==e.roundedCornerSize&&(t.roundedCornerSize=e.roundedCornerSize),void 0!==e.isOrientedText&&(t.isOrientedText=e.isOrientedText),void 0!==e.isOpaque&&(t.isOpaque=e.isOpaque),void 0!==e.arrowDst&&(t.arrowDst=e.arrowDst),void 0!==e.arrowOrg&&(t.arrowOrg=e.arrowOrg),void 0!==e.lineStyle&&(t.lineStyle=e.lineStyle),void 0!==e.orthoMargin&&(t.orthoMargin=e.orthoMargin),void 0!==e.points&&(t.points=e.points.slice())}function we(t,i){var n;if(X=!0,i)e.isNode(t)?Bt(t):e.isLink(t)&&ie(t);else{if(t.getIsSelected())s.push(t);else{for(n=s.length-1;n>=0&&t!==s[n];n--);s.splice(n,1)}e.canSendSelectionChangedEvent&&function(t){var e;(e=document.createEvent("Event")).initEvent("selectionChange",!0,!0),e.item=t,document.dispatchEvent(e)}(t),t.refresh()}}function Me(){var t;0===$&&((t=e.canvas.getContext("2d")).save(),t.scale(e.zoom,e.zoom),me(t,b),function(t,i){null!==i&&(t.fillStyle=e.fillStyle,t.fillRect(i.left,i.top,i.width,i.height),e.gridDraw&&function(t,e,i,n,o){var s,l,h,r,a,d;for(s=Math.floor(o.left/e)*e,l=Math.floor(o.top/i)*i,h=o.left+o.width,r=o.top+o.height,t.strokeStyle=n,t.lineWidth=.5,a=s;a<=h;a+=e)t.beginPath(),t.moveTo(a,o.top),t.lineTo(a,o.top+o.height),t.stroke();for(d=l;d<=r;d+=i)t.beginPath(),t.moveTo(o.left,d),t.lineTo(o.left+o.width,d),t.stroke()}(t,e.gridSizeX,e.gridSizeY,e.gridStrokeStyle,i))}(t,b),null!==e.ownerDraw&&null!==b&&e.ownerDraw(t),function(t,i){var s,l,h,r;if(null!==i)for(r=cA?o.ev(i):n,s=0;s<r.length;s++)h=(l=r[s]).lineWidth+e.handleSize,(e.isNode(l)?Et(l):re(l)).bH(h,h).fb(i)&&(e.isNode(l)?Oe(t,l):De(t,l))}(t,b),function(t,e){var i;if(null!==e)for(i=0;i<s.length;i++)Le(t,e,s[i])}(t,b),function(t,i){var n;if(null!==O&&!(tt||ot||nt||lt||st))if(null!==O.pins)for(n=0;n<H.length;n++)Pe(t,H[n]);else null!==C&&function(t,i){var n;t.lineWidth=1,(n=t.createLinearGradient(i.left,i.top,i.left+i.width,i.top+i.height)).addColorStop(0,e.centralPinGradientColor1),n.addColorStop(1,e.centralPinGradientColor2),t.fillStyle=n,t.strokeStyle=e.centralPinStrokeColor,yt.cK(t,i.left,i.top,i.width,i.height),t.stroke(),t.fill()}(t,C)}(t),function(t){tt?function(t){var i,n,o;i=new xt(S.x,S.y,y.x-S.x,y.y-S.y),t.lineWidth=e.nodeModel.lineWidth,t.strokeStyle=e.nodeModel.strokeStyle,e.nodeModel.gradientFillStyle!==e.nodeModel.fillStyle?((n=t.createLinearGradient(i.left,i.top,i.left+i.width,i.top+i.height)).addColorStop(0,e.nodeModel.fillStyle),n.addColorStop(1,e.nodeModel.gradientFillStyle),t.fillStyle=n):t.fillStyle=e.nodeModel.fillStyle,Ut(e.nodeModel)?yt.eg(t,i.left,i.top,i.width,i.height):Kt(e.nodeModel)?yt.cK(t,i.left,i.top,i.width,i.height):Qt(e.nodeModel)?void 0!==e.nodeModel.polygon&&null!==e.nodeModel.polygon?(o=[],e.nodeModel.x=i.left,e.nodeModel.y=i.top,e.nodeModel.w=i.width,e.nodeModel.h=i.height,Jt(e.nodeModel,o),yt.hM(t,o)):yt.cK(t,i.left,i.top,i.width,i.height):e.nodeModel.drawShape(t,i.left,i.top,i.width,i.height),t.stroke(),t.fill()}(t):et?function(t){t.lineWidth=e.linkModel.lineWidth,t.strokeStyle=e.linkModel.strokeStyle,t.beginPath(),t.moveTo(S.x,S.y),t.lineTo(y.x,y.y),t.stroke()}(t):(st||lt)&&function(t){t.strokeStyle=e.selRectStrokeStyle,t.fillStyle=e.selRectFillStyle,t.lineWidth=e.selRectLineWidth,t.strokeRect(M.left,M.top,M.width,M.height),t.fillRect(M.left,M.top,M.width,M.height)}(t)}(t),t.restore(),b=null)}function ke(t){null===t&&(t=new xt(0,0,e.canvas.width/e.zoom,e.canvas.height/e.zoom)),null===b?b=t:b.bI(t)}function me(t,e){null!==e&&(t.beginPath(),t.moveTo(e.left,e.top),t.lineTo(e.left+e.width,e.top),t.lineTo(e.left+e.width,e.top+e.height),t.lineTo(e.left,e.top+e.height),t.closePath(),t.clip())}function Le(t,i,n){var o,s,l;if(s=[],l=n.lineWidth+e.handleSize,(e.isNode(n)?Et(n):re(n)).bH(l,l).fb(i))if(Tt(n)){for(_t(n,s),o=0;o<s.length;o++)ze(t,s[o]);e.canShowContextHandle&&n.isContextHandle&&function(t,e){var i;null!==(i=Yt(n))&&Ae(t,i.left,i.top)}(t)}else if(Wt(n)){for(function(t,i){var n,o,s,l,h,r;for(o=(n=oe(t))?2*t.points.length-1:t.points.length,s=0;s<o;s++)n?s%2==0?h=t.points[s/2]:(l=Math.round(s/2)-1,h=yt.gY(t.points[l],t.points[l+1])):h=t.points[s],r=new xt(h.x-e.handleSize/2,h.y-e.handleSize/2,e.handleSize,e.handleSize),i.push(r)}(n,s),o=0;o<s.length;o++)He(t,s[o]);e.canShowContextHandle&&n.isContextHandle&&function(t,e){var i;null!==(i=Xt(n))&&Ae(t,i.left,i.top)}(t),"bezier"===n.getLineStyle()&&function(t,i){t.lineWidth=.2,t.strokeStyle=e.bezierSelectionLinesStrokeStyle,t.moveTo(i.points[0].x,i.points[0].y),t.lineTo(i.points[1].x,i.points[1].y),t.moveTo(i.points[3].x,i.points[3].y),t.lineTo(i.points[2].x,i.points[2].y),t.stroke()}(t,n)}}function Ae(t,i,n){var o,s;o=2*e.contextHandleSize/5-2,t.lineWidth=1,t.strokeStyle=e.contextHandleStrokeStyle,(s=t.createLinearGradient(i,n,i+o,n+o)).addColorStop(0,e.contextHandleGradientColor1),s.addColorStop(1,e.contextHandleGradientColor2),t.fillStyle=s,yt.eg(t,i,n,o,o),t.stroke(),t.fill(),(s=t.createLinearGradient(i+=1+o,n,i+o,n+o)).addColorStop(0,e.contextHandleGradientColor1),s.addColorStop(1,e.contextHandleGradientColor2),t.fillStyle=s,yt.eg(t,i,n,o,o),t.stroke(),t.fill(),(s=t.createLinearGradient(i+=1+o,n,i+o,n+o)).addColorStop(0,e.contextHandleGradientColor1),s.addColorStop(1,e.contextHandleGradientColor2),t.fillStyle=s,yt.eg(t,i,n,o,o),t.stroke(),t.fill()}function ze(t,i){var n;t.lineWidth=1,(n=t.createLinearGradient(i.left,i.top,i.left+i.width,i.top+i.height)).addColorStop(0,e.handleGradientColor1),n.addColorStop(1,e.handleGradientColor2),t.fillStyle=n,t.strokeStyle=e.handleStrokeStyle,yt.eg(t,i.left,i.top,i.width,i.height),t.stroke(),t.fill()}function Pe(t,i){var n;t.lineWidth=1,(n=t.createLinearGradient(i.left,i.top,i.left+i.width,i.top+i.height)).addColorStop(0,e.pinGradientColor1),n.addColorStop(1,e.pinGradientColor2),t.fillStyle=n,t.strokeStyle=e.pinStrokeStyle,yt.cK(t,i.left,i.top,i.width,i.height),t.stroke(),t.fill()}function He(t,i){var n;t.lineWidth=1,(n=t.createLinearGradient(i.left,i.top,i.left+i.width,i.top+i.height)).addColorStop(0,e.handleGradientColor1),n.addColorStop(1,e.handleGradientColor2),t.fillStyle=n,t.strokeStyle=e.handleStrokeStyle,yt.eg(t,i.left,i.top,i.width,i.height),t.stroke(),t.fill()}function Ce(t,e){t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor}function Oe(t,i){t.save(),function(t,i){var n,o;i.isShadowed&&Ce(t,e),t.lineWidth=i.lineWidth,t.strokeStyle=i.strokeStyle,Ut(i)?yt.eg(t,i.x,i.y,i.w,i.h):Kt(i)?yt.cK(t,i.x,i.y,i.w,i.h):Qt(i)?void 0!==i.polygon&&null!==i.polygon?(Jt(i,o=[]),yt.hM(t,o)):yt.cK(t,i.x,i.y,i.w,i.h):void 0!==i.drawShape&&null!==i.drawShape?i.drawShape(t,i.x,i.y,i.w,i.h):yt.cK(t,i.x,i.y,i.w,i.h),t.stroke(),i.gradientFillStyle!==i.fillStyle?((n=t.createLinearGradient(i.x,i.y,i.x+i.w,i.y+i.h)).addColorStop(0,i.fillStyle),n.addColorStop(1,i.gradientFillStyle),t.fillStyle=n):t.fillStyle=i.fillStyle,t.fill(),void 0!==i.fillShape&&null!==i.fillShape&&i.fillShape(t,i.x,i.y,i.w,i.h)}(t,i),t.restore(),t.save(),function(t,e){var i,n,o,s,l,h,r,a;if((null!==e.text&&0!==e.text.length||null!==e.image)&&(a=e.lineWidth/2,me(t,r=(r=Et(e)).bH(a,a)),void 0!==e.image&&null!==e.image&&(o=r.left+e.imageMargin.left,s=r.top+e.imageMargin.top,l=Math.max(0,r.width-e.imageMargin.left-e.imageMargin.right),h=Math.max(0,r.height-e.imageMargin.top-e.imageMargin.bottom),i=function(t,e,i){var n=e.gw();switch(n.width=i.width,n.height=i.height,t.imagePosition){case"leftTop":break;case"leftMiddle":n.top+=e.height/2-n.height/2;break;case"leftBottom":n.top+=e.height-n.height;break;case"rightTop":n.left+=e.width-n.width;break;case"rightMiddle":n.left+=e.width-n.width,n.top+=e.height/2-n.height/2;break;case"rightBottom":n.left+=e.width-n.width,n.top+=e.height-n.height;break;case"centerTop":n.left+=e.width/2-n.width/2;break;case"centerMiddle":n.left+=e.width/2-n.width/2,n.top+=e.height/2-n.height/2;break;case"centerBottom":n.left+=e.width/2-n.width/2,n.top+=e.height-n.height}return n}(e,new xt(o,s,l,h),e.image),t.drawImage(e.image,i.left,i.top,i.width,i.height)),void 0!==e.text&&null!==e.text&&e.text.length>0)){switch(o=r.left+e.textMargin.left,s=r.top+e.textMargin.top,l=Math.max(0,r.width-e.textMargin.left-e.textMargin.right),h=Math.max(0,r.height-e.textMargin.top-e.textMargin.bottom),t.fillStyle=e.textFillStyle,t.font=e.font,t.textBaseline="top",n={width:0,height:0},null!==e.textLineHeight&&(n=yt.fV(t,e.text,0,0,e.textLineHeight,l,!1)),e.textPosition){case"leftTop":t.textAlign="start";break;case"centerTop":t.textAlign="center",o+=l/2;break;case"rightTop":t.textAlign="end",o+=l;break;case"leftMiddle":t.textAlign="start",null===e.textLineHeight&&(t.textBaseline="middle"),s+=h/2-n.height/2;break;case"centerMiddle":t.textAlign="center",null===e.textLineHeight&&(t.textBaseline="middle"),o+=l/2,s+=h/2-n.height/2;break;case"rightMiddle":t.textAlign="end",null===e.textLineHeight&&(t.textBaseline="middle"),o+=l,s+=h/2-n.height/2;break;case"leftBottom":t.textAlign="start",null===e.textLineHeight&&(t.textBaseline="bottom"),s+=h-n.height;break;case"centerBottom":t.textAlign="center",null===e.textLineHeight&&(t.textBaseline="bottom"),o+=l/2,s+=h-n.height;break;case"rightBottom":t.textAlign="end",null===e.textLineHeight&&(t.textBaseline="bottom"),o+=l,s+=h-n.height}null!==e.textLineHeight?yt.fV(t,e.text,o,s,e.textLineHeight,l,!0):t.fillText(e.text,o,s)}}(t,i),t.restore()}function De(t,e){var i,n,o,s,l,h,r,a,d,f;switch(t.save(),e.isShadowed&&Ce(t,e.flow),t.lineWidth=e.lineWidth,t.strokeStyle=e.strokeStyle,e.getLineStyle()){case"polyline":case"database":case"orthogonal":(i=e.roundedCornerSize)>0&&e.points.length>2?yt.kw(t,e.points,i):yt.io(t,e.points);break;case"spline":yt.kZ(e.points,n=[]),yt.io(t,n);break;case"bezier":yt.lz(t,e.points[0],e.points[1],e.points[2],e.points[3])}t.stroke(),void 0!==e.arrowDst&&null!==e.arrowDst&&function(t,e){var i,n,o;i=e.points[e.points.length-2],n=e.points[e.points.length-1],"bezier"===e.getLineStyle()&&(i=yt.jE(e.points[0],e.points[1],e.points[2],e.points[3])),o=Math.atan2(n.y-i.y,n.x-i.x),t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,yt.hY(t,yt.ir(yt.gM(e.arrowDst,o),n.x,n.y))}(t,e),void 0!==e.arrowOrg&&null!==e.arrowOrg&&function(t,e){var i,n,o;i=e.points[1],n=e.points[0],"bezier"===e.getLineStyle()&&(i=yt.jE(e.points[3],e.points[2],e.points[1],e.points[0])),o=Math.atan2(n.y-i.y,n.x-i.x),t.fillStyle=e.fillStyle,t.strokeStyle=e.strokeStyle,yt.hY(t,yt.ir(yt.gM(e.arrowOrg,o),n.x,n.y))}(t,e),t.restore(),void 0!==e.text&&null!==e.text&&e.text.length>0&&(o=[],"bezier"===e.lineStyle?yt.hb(e.points[0],e.points[1],e.points[2],e.points[3],o):o=e.points,null!==(l=(s=new Ot(o)).jA(.5))&&(null!==(h=s.jZ())?(f=Math.atan2(h.y,h.y)*(180/Math.PI),h.y<0&&(f+=180)):f=0,t.translate(l.x,l.y),e.isOrientedText&&t.rotate(-f),t.font=e.font,r=t.measureText(e.text).width,a=1.2*parseInt(e.font,10),e.isOpaque&&void 0!==a?((d=new xt(-r/2,-a/2,r,a)).bH(2,2),t.fillStyle=e.flow.fillStyle,t.fillRect(d.left,d.top,d.width,d.height),t.fillStyle=e.textFillStyle,t.textBaseline="middle",t.fillText(e.text,-r/2,0)):(t.fillStyle=e.textFillStyle,t.fillText(e.text,-r/2,-2)),e.isOrientedText&&t.rotate(f),t.translate(-l.x,-l.y)))}function Ie(t,i){var n,o,s,l,h,r,a,d;return a=!1,(d=Et(t)).bf(i)&&(Kt(t)?a=!0:Ut(t)?(h=d.af(),(o=d.height/2*(i.x-h.x))*o+(s=d.width/2*(i.y-h.y))*s<=(l=d.width/2*d.height/2)*l&&(a=!0)):Qt(t)?(n=e.canvas.getContext("2d"),void 0!==t.polygon&&null!==t.polygon?(Jt(t,r=[]),yt.hM(n,r),a=n.isPointInPath(i.x,i.y)):a=!0):(n=e.canvas.getContext("2d"),void 0!==t.drawShape&&null!==t.drawShape&&(t.drawShape(n,t.x,t.y,t.w,t.h),a=n.isPointInPath(i.x,i.y)))),a}function je(t,i){var n,o,s;return n=!1,o=0,re(t).bf(i)&&(s=[],"bezier"===t.getLineStyle()?yt.hb(t.points[0],t.points[1],t.points[2],t.points[3],s):s=t.points,(o=yt.kV(s,s.length,i,e.linkSelectionAreaWidth))<=e.linkSelectionAreaWidth&&(z=o,n=!0)),n}function Te(t,e){var i,n;return{x:(i=Et(t)).left+i.width/100*(n=t.pins[e])[0],y:i.top+i.height/100*n[1]}}function We(t){var i,n;if(!ht){if(e.hitArea="outSide",G="default",l=Xe(t,it?d.nodes:d.items),null!==O)if(null===l)if(function(t,e){var i,n;for(n=Et(O),i=0;i<H.length;i++)n.bI(H[i]);return n.bf(e)}(0,t)){if(Fe(O,t))return}else Bt(O),O=null,H.splice(0,H.length),C=null,Me();else l!==O&&(Bt(O),O=null,H.splice(0,H.length),C=null,Me());if(null===l||(Tt(l)?(e.hitArea="G",!et&&e.canMoveNode&&(l.isXMoveable||l.isYMoveable)&&(G="move")):e.hitArea="J",!Tt(l)||(O=l,!Fe(l,t))))for(!P&&et&&(null!==l&&Tt(l)||(P=!0)),i=0;i<s.length;i++)Tt(n=s[i])?Ve(n,t):Wt(n)&&Ye(n,t)}}function Fe(t,i){var n,o,s;if(et){if(e.canDrawLink&&t.isInLinkable&&(t.refresh(),null!==t.pins))for(Ge(t,H),n=0;n<H.length;n++)if(H[n].bf(i))return j=n,H[n].af(),e.hitArea="pin",G="crosshair",!0}else if(e.canDrawLink&&t.isOutLinkable)if(t.refresh(),null!==t.pins){for(Ge(t,H),n=0;n<H.length;n++)if(H[n].bf(i))return I=n,v=H[n].af(),e.hitArea="pin",G="crosshair",!0}else if(s=e.pinSize,o=Et(t),(C=new xt(o.left+o.width/2-s/2,o.top+o.height/2-s/2,s,s)).bf(i))return v=C.af(),e.hitArea="centralPin",G="crosshair",!0;return!1}function Ne(t,e){var i,n;if(n=-1,null!==t.pins)for(Ge(t,H),i=0;i<H.length;i++)if(H[i].bf(e)){n=i;break}return n}function Ge(t,i){var n,o,s;if(s=e.pinSize,i.splice(0,i.length),void 0!==t.pins&&null!==t.pins)for(o=0;o<t.pins.length;o++)n=Et(t),i.push(new xt(n.left+n.width/100*t.pins[o][0]-s/2,n.top+n.height/100*t.pins[o][1]-s/2,s,s))}function Re(t){var i;return i=t.lineWidth+5*e.handleSize/2,t.isContextHandle&&(i+=e.contextHandleSize),Et(t).bH(i,i)}function Ze(t){var i;return i=t.lineWidth+e.handleSize,t.isContextHandle&&(i+=e.contextHandleSize),re(t).bH(i,i)}function Ve(t,i){var n,o,s;if(o=[],(s=Re(t)).bf(i)){if(e.canShowContextHandle&&t.isContextHandle&&m&&null!==(s=Yt(t))&&s.bf(i))return It(t),void(m=!1);for(_t(t,o),n=0;n<o.length;n++)if(o[n].bf(i)){switch(e.hitArea="resizeHandle",e.ey=n,e.ey){case a.left:case a.right:e.canSizeNode&&t.isXSizeable?G="e-resize":(e.hitArea="outSide",G="default");break;case a.down:case a.up:e.canSizeNode&&t.isYSizeable?G="n-resize":(e.hitArea="outSide",G="default");break;case a.gQ:case a.fI:case a.ih:case a.fX:e.canSizeNode&&(t.isXSizeable||t.isYSizeable)?t.isXSizeable?t.isYSizeable?G=e.ey===a.gQ||e.ey===a.fI?"ne-resize":"se-resize":(e.hitArea="leftHandle",G="e-resize"):(e.hitArea="upHandle",G="n-resize"):(e.hitArea="outSide",G="default")}break}}}function Ye(t,i){var n,o,s,l,h,a;if(!(it||t.points.length<2)&&(h=Ze(t)).bf(i)){if(e.canShowContextHandle&&t.isContextHandle&&m&&null!==(h=Xt(t))&&h.bf(i))return It(t),void(m=!1);if(a=t.points.length,oe(t)){for(l=2*a-1,n=0;n<l;n++)if(n%2==0?s=t.points[n/2]:(o=Math.round(n/2)-1,s=yt.gY(t.points[o],t.points[o+1])),(h=new xt(s.x-e.handleSize/2,s.y-e.handleSize/2,e.handleSize,e.handleSize)).bf(i)){W=t,e.hitArea="stretchHandle",0===n?e.canChangeOrg&&(T=r.first,G="crosshair"):n===l-1?e.canChangeDst&&(T=r.last,G="crosshair"):e.canStretchLink&&t.isStretchable?(G="crosshair",T=n%2!=0?r.add:r.del):T=r.none,A=n%2!=0?Math.round(n/2)-1:n/2;break}}else for(l=a,n=0;n<l;n++)if((h=new xt((s=t.points[n]).x-e.handleSize/2,s.y-e.handleSize/2,e.handleSize,e.handleSize)).bf(i)){e.hitArea="stretchHandle",W=t,0===n?e.canChangeOrg&&(T=r.first,G="crosshair"):n===a-1?e.canChangeDst&&(T=r.last,G="crosshair"):e.canStretchLink&&t.isStretchable?(G="crosshair",T=r.change):T=r.none,A=n;break}}}function Xe(t,i){var s,l,h,r;for(r=cA?o.ev(new xt(t.x-5,t.y-5,10,10)):n,h=null,s=0;s<r.length;s++)switch(l=r[s],i){case d.items:if(Tt(l))Ie(l,t)&&(h=l);else if(Wt(l)){if(null!==h&&Tt(h)&&(l.dst===h||l.org===h))continue;je(l,t)&&z<=e.linkSelectionAreaWidth&&(h=l)}break;case d.nodes:Tt(l)&&Ie(l,t)&&(h=l);break;case d.links:Wt(l)&&je(l,t)&&z<=e.linkSelectionAreaWidth&&(h=l);break;case d.hX:if(l.isSelectable)if(Tt(l))Ie(l,t)&&(h=l);else if(Wt(l)){if(null!==h&&Tt(h)&&(l.dst===h||l.org===h))continue;je(l,t)&&z<=e.linkSelectionAreaWidth&&(h=l)}break;case d.jQ:l.isSelectable&&Tt(l)&&Ie(l,t)&&(h=l);break;case d.hZ:l.isSelectable&&Wt(l)&&je(l,t)&&z<=e.linkSelectionAreaWidth&&(h=l)}return h}function _e(){$++}function Ee(){0==--$&&(qe(),cA&&jt(),e.refresh())}function Be(){e.isFixedSize?(e.canvas.width=F,e.canvas.height=N):(e.canvas.width=k.width*e.zoom+F,e.canvas.height=k.height*e.zoom+N),ke(null)}function qe(){if(0===$){var t=function(){var t,i,o,s,l;for(o=new xt(0,0,0,0),l=!0,t=0;t<n.length;t++)s=e.isNode(i=n[t])?Et(i):re(i),l?(o=s,l=!1):o.bI(s);return o.width+=o.left,o.height+=o.top,o.left=0,o.top=0,o}();t.jp(k)||(k=t,Be())}}function Ue(t){if(0===$){var e=k.jJ(t);e.jp(k)||(k=e,Be())}}function Ke(t){var i,n,o,s,l,h,r;s=e.canvas.width,l=e.canvas.height,null!==(i=e.canvas.parentNode)&&void 0!==i&&(h=parseInt(i.style.width,10),r=parseInt(i.style.height,10),isNaN(h)||isNaN(r)||(s=h,l=r)),e.zoom=(n=s/t.width)>(o=l/t.height)?o:n,e.refresh(),null!==i&&void 0!==i&&(i.scrollLeft=t.left*e.zoom,i.scrollTop=t.top*e.zoom)}function Qe(){e.canvas.setCapture?e.canvas.setCapture():window.addEventListener&&window.addEventListener("mousemove",e.canvas,!0)}function Je(i){var n,o,s;return s=t.getBoundingClientRect(),n=i.clientX-s.left,o=i.clientY-s.top,{x:n+=e.xCustomOffset,y:o+=e.yCustomOffset}}function $e(t){e.refresh()}function ti(t){t.preventDefault(),ni(t)}function ei(t){t.preventDefault(),oi(t)}function ii(t){si()}function ni(t){var i,n,o,s,h,r,a,d,f,u;if(o=Je(t),s={out:0,mZ:1,G:2,iQ:3,hn:4,hQ:5,link:6,gf:7,jn:8,iL:9},h=e.canMultiSelect&&(t.shiftKey||t.ctrlKey),r=!1,a=!1,d=!1,f=!1,u=!1,o.x=o.x/e.zoom,o.y=o.y/e.zoom,m=!0,L=!0,U=!1,_=!1,E=!1,q=!1,B=!1,K=!1,Q=!1,J=!1,x=o,S=y=o,M=new xt(S.x,S.y,0,0),We(o),"stretchHandle"!==e.hitArea){if("resizeHandle"===e.hitArea)return e.gridSnap&&(y=yt.du(o,e.gridSizeX,e.gridSizeY)),void(q=!0);if("pin"===e.hitArea||"centralPin"===e.hitArea)return B=!0,P=!1,D=O,y=v,void(S=v);switch(null!==(n=l)&&n.isSelectable?Wt(n)?i=n.getIsSelected()?h?s.iL:s.gf:h?s.jn:s.link:Tt(n)&&(i=n.getIsSelected()?h?s.hQ:s.iQ:h?s.hn:s.G):i=h?s.mZ:s.out,i){case s.out:Zt(),"none"===e.mouseSelection?e.canDrawNode&&(a=!0):"zoom"===e.mouseSelection?f=!0:"pan"===e.mouseSelection?u=!0:"none"!==e.mouseSelection&&"zoom"!==e.mouseSelection&&(d=!0);break;case s.link:Zt(),null!==n&&n.setIsSelected(!0);break;case s.G:Zt(),null!==n&&n.setIsSelected(!0),null!==n&&e.canMoveNode&&(n.isXMoveable||n.isYMoveable)&&(r=!0);break;case s.iQ:null!==n&&e.canMoveNode&&(n.isXMoveable||n.isYMoveable)&&(r=!0);break;case s.gf:e.canMoveNode&&(r=!0);break;case s.hQ:case s.hn:case s.iL:case s.jn:null!==n&&n.setIsSelected(!n.getIsSelected())}r?(_=!0,e.gridSnap&&(y=yt.du(y,e.gridSizeX,e.gridSizeY))):a?(E=!0,e.gridSnap&&(y=yt.du(y,e.gridSizeX,e.gridSizeY)),S=y):d?K=!0:f?Q=!0:u&&(J=!0),Me()}else U=!0}function oi(t){var i,n;if(i=Je(t),null!==(n=e.canvas.parentNode)&&(dt={x:i.x-n.scrollLeft,y:i.y-n.scrollTop}),i.x=i.x/e.zoom,i.y=i.y/e.zoom,L){if(Math.abs(i.x-x.x)<f&&Math.abs(i.y-x.y)<f)return;L=!1}We(i),e.canvas.style.cursor=G,m&&(E?li(di,n)||gi(i):B?li(fi,n)||xi(i):_?li(hi,n)||yi(i):q?li(ri,n)||wi(i):U?li(ai,n)||ki(i):K?li(ui,n)||mi(i):Q?li(pi,n)||Ai(i):J&&function(t){var i,n,o,s,l;ht||function(t){var i=e.canvas.parentNode;null!==i&&void 0!==i&&(ht=!0,V=i.scrollLeft,Y=i.scrollTop,ct=t,Qe())}(t),null!==(o=e.canvas.parentNode)&&void 0!==o&&(s=parseInt(o.style.width,10),l=parseInt(o.style.height,10),isNaN(s)||isNaN(l)||(G=e.canvas.width>s||e.canvas.height>l?"pointer":"default",i=t.x>ct.x?-(t.x-ct.x):ct.x-t.x,n=t.y>ct.y?-(t.y-ct.y):ct.y-t.y,0!==i&&(o.scrollLeft=V+=i),0!==n&&(o.scrollTop=Y+=n)))}(i))}function si(t){var n,l,h,a,p,c;e.canvas.releaseCapture?e.canvas.releaseCapture():window.removeEventListener&&window.removeEventListener("mousemove",e.canvas,!0),m&&(m=!1,tt?(tt=!1,function(){var t,i,n;ke((t=yt.aV(S,y)).bH(i=e.nodeModel.lineWidth+e.handleSize,i)),Me(),e.canDrawNode&&t.width>u&&t.height>u&&null!==(n=Ft(t.left,t.top,t.width,t.height))&&n.isSelectable&&(Zt(),n.setIsSelected(!0))}()):et?(et=!1,function(){var t,i,n,o,s;if(s=2*e.linkModel.lineWidth,ke(yt.aV(S,y).bH(s,s)),Me(),e.canDrawLink&&(t=I,i=j,I=null,j=null,null!==(n=null!==O?O:Xe(y,d.nodes))&&null!==D&&n.isInLinkable)){if(D===n){if(!e.canReflexLink)return;if(!P)return}!e.canMultiLink&&ee(D,n)||null!==D.pins&&null===t||null!==n.pins&&null===i||(e.linkModel.getLineStyle(),null!==(o=Gt(D,n,"",t,i))&&o.isSelectable&&(Zt(),o.setIsSelected(!0)))}}()):ot?(ot=!1,function(){var t,e,n,o,l;if(i.aL()){for(i.dN("AF_moveSelectedNodes"),bi(),o=0;o<s.length;o++)if(Tt(t=s[o]))for(i.bG(t.H),t.H=null,n=t.getLinks(),l=0;l<n.length;l++)ie(e=n[l]),void 0!==e.aP&&(e.aP&&(e.aP=!1,null!==e.H&&(i.bG(e.H),e.H=null)),delete e.aP);i.cV()}}()):nt?(nt=!1,function(){var t,e,n,o,l;if(i.aL()){for(i.dN("AF_resizeSelectedNodes"),t=0;t<s.length;t++)Tt(n=s[t])&&i.bG(n.H);i.cV()}for(t=0;t<s.length;t++)if(Tt(n=s[t]))for(l=n.getLinks(),e=0;e<l.length;e++)ie(o=l[e]),void 0!==o.aP&&delete o.flag;Me()}()):it?(it=!1,l=W,W=null,A=Math.max(Math.min(A,l.points.length-1),0),h=l.points[A],oe(l)&&(T===r.add||T===r.del)&&A>0&&A<l.points.length-1&&yt.hk(l.points[A-1],l.points[A+1],l.points[A])<=e.removePointDistance?(ie(l),l.removePoint(A),ie(l),Me(),T=r.none):(ie(l),"database"===l.getLineStyle()?de(l):"orthogonal"===l.getLineStyle()&&fe(l),null!==l.org.pins||l.isOrgPointAdjustable||pe(l),null!==l.dst.pins||l.isDstPointAdjustable||ue(l),ie(l),Me(),T===r.first&&e.canChangeOrg?null===(a=Xe(h,d.nodes))?(l.H.undo(),l.fd=re(l),cA&&o.cs(l,l.fd),ie(l),Me()):a!==l.org?function(t,i){return!(!a.isOutLinkable||!e.canReflexLink&&t.dst===a||!e.canMultiLink&&function(t,e){var i,n,o,s;for(o=!1,s=$t(t),i=0;i<s.length;i++)if((n=s[i]).org===e&&n.dst===t){o=!0;break}return o}(t.dst,a))}(l)?(i.aL&&i.dN("AF_linkStretch"),i.aL()&&i.bG(l.H),l.setOrg(a),(c=Ne(a,h))>=0&&le(l,c),Me(),i.aL&&i.cV()):(l.H.undo(),l.fd=re(l),cA&&o.cs(l,l.fd),ie(l),Me()):(c=Ne(a,h))>=0?le(l,c):(l.H.undo(),l.fd=re(l),cA&&o.cs(l,l.fd),ie(l),Me()):T===r.last&&e.canChangeDst?null===(p=Xe(h,d.nodes))?(l.H.undo(),l.fd=re(l),cA&&o.cs(l,l.fd),ie(l),Me()):p!==l.dst?function(t,i){return!(!p.isInLinkable||!e.canReflexLink&&t.org===p||!e.canMultiLink&&ee(t.org,p))}(l)?(i.aL&&i.dN("AF_linkStretch"),i.aL()&&i.bG(l.H),l.setDst(p),(c=Ne(p,h))>=0&&he(l,c),i.aL&&i.cV()):(l.H.undo(),l.fd=re(l),cA&&o.cs(l,l.fd),ie(l),Me()):(c=Ne(p,h))>=0?he(l,c):(l.H.undo(),l.fd=re(l),cA&&o.cs(l,l.fd),ie(l),Me()):i.aL()&&i.bG(l.H))):st?(st=!1,ke(M.bH(e.selRectLineWidth,e.selRectLineWidth)),e.canSelectOnMouseMove||Li(),Me()):lt?(lt=!1,ke(n=M.bH(e.selRectLineWidth,e.selRectLineWidth)),Me(),n.width>f&&n.height>f&&Ke(n)):ht&&(ht=!1))}function li(t,i){var n,o,s,l,h;return null!==i&&void 0!==i&&(l=parseInt(i.style.width,10),h=parseInt(i.style.height,10),!(isNaN(l)||isNaN(h)||(n=i.scrollLeft,o=i.scrollTop,(s=new xt(0,0,l,h)).width-=20,s.height-=20,s.bf(dt)?(null!==ut&&clearInterval(ut),ft=!1,1):(e.canDragScroll&&(rt="none",at="none",dt.x>s.left+s.width?rt="right":dt.x<s.left&&n>0&&(rt="left"),dt.y>s.top+s.height?at="bottom":dt.y<s.top&&o>0&&(at="top"),"none"===rt&&"none"===at||ft||(ut=setInterval(t,p),ft=!0)),0))))}function hi(){yi(ci())}function ri(){wi(ci())}function ai(){ki(ci())}function di(){gi(ci())}function fi(){xi(ci())}function ui(){mi(ci())}function pi(){Ai(ci())}function ci(){var t,i,n,o;return m||(null!==ut&&clearInterval(ut),ft=!1),t=0,i=0,"none"!==rt&&(t="right"===rt?c:-c),"none"!==at&&(i="bottom"===at?g:-g),null!==(n=e.canvas.parentNode)&&void 0!==n?(o=n.scrollTop,n.scrollLeft=n.scrollLeft+t,n.scrollTop=o+i,{x:n.scrollLeft+dt.x,y:n.scrollTop+dt.y}):{x:0,y:0}}function gi(t){var i;e.gridSnap&&(t=yt.du(t,e.gridSizeX,e.gridSizeY)),tt||(tt=!0,Qe()),i=e.nodeModel.lineWidth+e.handleSize,ke(yt.aV(S,y).bH(i,i)),ke(yt.aV(S,t).bH(i,i)),Me(),y=t}function xi(t){var i;et||(et=!0,Qe()),P||null!==l&&Tt(l)||(P=!0),i=2*e.linkModel.lineWidth,ke(yt.aV(S,y).bH(i,i)),ke(yt.aV(S,t).bH(i,i)),y=t,Me()}function yi(t){var n,o,l,h;if(e.gridSnap&&(t=yt.du(t,e.gridSizeX,e.gridSizeY)),ot||function(){var t,n,o,l,h;for(ot=!0,Qe(),w=vi(),t=0;t<s.length;t++)if(Tt(l=s[t]))for(i.aL()&&(l.H=new wt(e,l,Et(l))),h=l.getLinks(),n=0;n<h.length;n++)h[n].aP=!0;for(t=0;t<s.length;t++)if(Tt(l=s[t]))for(h=l.getLinks(),n=0;n<h.length;n++)(o=h[n]).aP&&(o.H=new At(e,o),o.aP=!1)}(),i.skipUndo=!0,l=t.x-y.x,h=t.y-y.y,y=t,w.left+l<0&&(l-=w.left+l),w.top+h<0&&(h-=w.top+h),0!==l||0!==h){for(bi(),n=0;n<s.length;n++)Tt(o=s[n])&&Si(o,l,h);w=vi()}qe(),Me(),i.skipUndo=!1}function Si(t,e,i){var n,s,l,h,r,a,d,f;if(d=t.isXMoveable?e:0,f=t.isYMoveable?i:0,0!==d||0!==f){for(cA&&o.dS(t),a=$t(t),s=0;s<a.length;s++){if(r=(h=a[s]).points.length,ie(h),h.org.getIsSelected()&&h.dst.getIsSelected()){if(h.aP)for(h.aP=!1,l=0;l<r;l++)h.points[l]={x:(n=h.points[l]).x+d,y:n.y+f}}else t===h.dst&&(null!==h.dst.pins||h.isDstPointAdjustable)&&(h.points[r-1]={x:(n=h.points[r-1]).x+d,y:n.y+f}),t===h.org&&(null!==h.org.pins||h.isOrgPointAdjustable)&&(h.points[0]={x:(n=h.points[0]).x+d,y:n.y+f});ie(h),h.refresh()}Bt(t),t.x+=d,t.y+=f,t.fd=Et(t),cA&&o.cs(t,t.fd),t.refresh(),te(t)}}function vi(){var t,i,n,o,l,h,r;for(n=0;n<s.length;n++)if(i=e.isNode(l=s[n])?Et(l):re(l),0===n?t=i:t.bI(i),Tt(l))for(h=l.getLinks(),o=0;o<h.length;o++)(r=h[o]).org.getIsSelected()&&r.dst.getIsSelected()&&t.bI(re(r));else Wt(l)&&0===n&&l.org.getIsSelected()&&l.dst.getIsSelected()&&(t=re(l));return t}function bi(){var t,e,i,n;for(t=0;t<s.length;t++)if(Tt(n=s[t]))for(i=n.getLinks(),e=0;e<i.length;e++)i[e].aP=!0}function wi(t){var n,l,h,r,d,f,u;for(e.gridSnap&&(t=yt.du(t,e.gridSizeX,e.gridSizeY)),nt||function(){var t,n,o,l;for(nt=!0,Qe(),t=0;t<s.length;t++)if(Tt(o=s[t]))for(i.aL()&&(o.H=new wt(e,o,Et(o))),l=o.getLinks(),n=0;n<l.length;n++)l[n].aP=!0}(),i.skipUndo=!0,h=t.x-y.x,r=t.y-y.y,n=0;n<s.length;n++)if(Tt(l=s[n])){switch(cA&&o.dS(l),f=(d=Et(l)).left,u=d.top,dx=f+h<0?0:h,dy=u+r<0?0:r,e.ey){case a.ih:d.width=Math.max(d.width-dx,e.handleSize),d.height=Math.max(d.height-dy,e.handleSize),d.left=f+dx,d.top=u+dy;break;case a.up:d.height=Math.max(d.height-dy,e.handleSize),d.top=u+dy;break;case a.fI:d.width=Math.max(d.width+dx,e.handleSize),d.height=Math.max(d.height-dy,e.handleSize),d.top=u+dy;break;case a.left:d.width=Math.max(d.width-dx,e.handleSize),d.left=f+dx;break;case a.right:d.width=Math.max(d.width+dx,e.handleSize);break;case a.gQ:d.width=Math.max(d.width-dx,e.handleSize),d.height=Math.max(dy+d.height,e.handleSize),d.left=f+dx;break;case a.down:d.height=Math.max(d.height+dy,e.handleSize);break;case a.fX:d.width=Math.max(d.width+dx,e.handleSize),d.height=Math.max(dy+d.height,e.handleSize)}qt(l,d),l.fd=d,cA&&o.cs(l,l.fd),l.refresh(),Mi(l,d)}i.skipUndo=!1,qe(),Me(),y=t}function Mi(t,e){var i,n,o,s;for(n=t.getLinks(),i=0;i<n.length;i++)(o=n[i]).aP||(t===o.dst&&null!==o.dst.pins&&(o.points[(s=o.points.length)-1]={x:e.left+(0===e.width?0:(o.points[s-1].x-e.left)*e.width/e.width),y:e.top+(0===e.height?0:(o.points[s-1].y-e.top)*e.height/e.height)}),t===o.org&&null!==o.org.pins&&(o.points[0]={x:e.left+(0===e.width?0:(o.points[0].x-e.left)*e.width/e.width),y:e.top+(0===e.height?0:(o.points[0].y-e.top)*e.height/e.height)})),ne(o)&&(o.aP=!o.aP);!function(t){var e,i,n;if(null!==t.pins)for(n=t.getLinks(),e=0;e<n.length;e++)(i=n[e]).org===t&&null!==i.pinOrg?i.points[0]=Te(t,i.pinOrg):i.dst===t&&null!==i.pinDst&&(i.points[i.points.length-1]=Te(t,i.pinDst))}(t)}function ki(t){var n;null!==W&&(it||(n=W,it=!0,Qe(),i.aL()&&(n.H=new At(e,n)),"database"===n.getLineStyle()?ce(n):(ce(n),T===r.add&&(function(t,e,i){t.points.splice(A+1,0,e)}(n,yt.gY(n.points[A],n.points[A+1])),A++))),t.x<0&&(t.x=0),t.y<0&&(t.y=0),cA&&o.dS(W),ie(W),"database"===W.getLineStyle()?function(t,e){var i,n;switch(A){case 0:i=e.points[1].x-e.points[0].x,e.points[0]=t,e.points[1]={x:e.points[0].x+i,y:t.y};break;case 1:e.points[1]={x:t.x,y:e.points[1].y};break;case 2:e.points[2]={x:t.x,y:e.points[2].y};break;case 3:n=e.points[2].x-e.points[3].x,e.points[3]=t,e.points[2]={x:e.points[3].x+n,y:t.y}}}(t,W):"orthogonal"===W.getLineStyle()?function(t,e){var i;3===(i=e.points.length)?0===A?e.ij?(e.points[0]=t,e.points[1]={x:e.points[1].x,y:t.y}):(e.points[0]=t,e.points[1]={x:t.x,y:e.points[1].y}):1===A?e.ij?(t.x=Math.min(t.x,e.dst.x+e.dst.w),t.x=Math.max(t.x,e.dst.x),t.y=Math.min(t.y,e.org.y+e.org.h),t.y=Math.max(t.y,e.org.y),null===e.org.pins&&(e.points[0]={x:t.x,y:e.points[0].y},e.points[1]={x:e.points[1].x,y:t.y}),null===e.dst.pins&&(e.points[2]={x:e.points[2].x,y:t.y},e.points[1]={x:t.x,y:e.points[1].y})):(t.x=Math.min(t.x,e.org.x+e.org.w),t.x=Math.max(t.x,e.org.x),t.y=Math.min(t.y,e.dst.y+e.dst.h),t.y=Math.max(t.y,e.dst.y),null===e.org.pins&&(e.points[0]={x:t.x,y:e.points[0].y},e.points[1]={x:t.x,y:e.points[1].y}),null===e.dst.pins&&(e.points[2]={x:e.points[2].x,y:t.y},e.points[1]={x:e.points[1].x,y:t.y})):2===A&&(e.ij?(e.points[2]=t,e.points[1]={x:t.x,y:e.points[1].y}):(e.points[2]=t,e.points[1]={x:e.points[1].x,y:t.y})):A<=1?1===A&&(e.ij?null!==e.org.pins?e.points[1]={x:t.x,y:e.points[1].y}:(t.y=Math.min(t.y,e.org.y+e.org.h),t.y=Math.max(t.y,e.org.y),e.points[0]={x:e.points[0].x,y:t.y},e.points[1]=t):null!==e.org.pins?e.points[1]={x:e.points[1].x,y:t.y}:(t.x=Math.min(t.x,e.org.x+e.org.w),t.x=Math.max(t.x,e.org.x),e.points[0]={x:t.x,y:e.points[0].y},e.points[1]=t)):A>=i-2&&A===i-2&&(e.ij&&(i-1)%2==0||!e.ij&&(i-1)%2==1?null!==e.dst.pins?e.points[i-2]={x:e.points[i-1].x,y:t.y}:(t.x=Math.min(t.x,e.dst.x+e.dst.w),t.x=Math.max(t.x,e.dst.x),e.points[i-1]={x:t.x,y:e.points[i-1].y},e.points[i-2]=t):null!==e.dst.pins?e.points[i-2]={x:t.x,y:e.points[i-1].y}:(t.y=Math.min(t.y,e.dst.y+e.dst.h),t.y=Math.max(t.y,e.dst.y),e.points[i-1]={x:e.points[i-1].x,y:t.y},e.points[i-2]=t)),function(t,e,i){var n=t.points.length;t.ij?n>3&&(0===i?(t.points[0]=e,t.points[1]={x:t.points[1].x,y:e.y}):1===i?(t.points[1]={x:e.x,y:t.points[1].y},t.points[2]={x:e.x,y:t.points[2].y}):i===n-1?n%2==0?(t.points[n-1]=e,t.points[n-2]={x:t.points[n-2].x,y:e.y}):t.points[n-2]={x:e.x,y:t.points[n-2].y}:i===n-2?n%2==0?(t.points[n-3]={x:e.x,y:t.points[n-3].y},t.points[n-2]={x:e.x,y:t.points[n-2].y}):(t.points[n-3]={x:t.points[n-3].x,y:e.y},t.points[n-2]={x:t.points[n-2].x,y:e.y}):(t.points[i]=e,i%2==0?(t.points[i-1]={x:e.x,y:t.points[i-1].y},t.points[i+1]={x:t.points[i+1].x,y:e.y}):(t.points[i-1]={x:t.points[i-1].x,y:e.y},t.points[i+1]={x:e.x,y:t.points[i+1].y}))):n>3&&(0===i?(t.points[0]=e,t.points[1]={x:e.x,y:t.points[1].y}):1===i?(t.points[1]={x:t.points[1].x,y:e.y},t.points[2]={x:t.points[2].x,y:e.y}):i===n-1?(t.points[n-2]=n%2==0?{x:e.x,y:t.points[n-2].y}:{x:t.points[n-2].x,y:e.y},t.points[n-1]=e):i===n-2?n%2==0?(t.points[n-3]={x:t.points[n-3].x,y:e.y},t.points[n-2]={x:t.points[n-2].x,y:e.y}):(t.points[n-3]={x:e.x,y:t.points[n-3].y},t.points[n-2]={x:t.points[n-2].x,y:e.y}):(t.points[i]=e,i%2==0?(t.points[i-1]={x:t.points[i-1].x,y:e.y},t.points[i+1]={x:e.x,y:t.points[i+1].y}):(t.points[i-1]={x:e.x,y:t.points[i-1].y},t.points[i+1]={x:t.points[i+1].x,y:e.y})))}(e,t,A)}(t,W):function(t,e){A>=0&&A<=e.points.length-1&&(e.points[A]=t),null!==e.org.pins||e.isOrgPointAdjustable||T===r.first||pe(e),null!==e.dst.pins||e.isDstPointAdjustable||T===r.last||ue(e)}(t,W),ie(W),W.fd=re(W),cA&&o.cs(W,W.fd),y=t,qe(),Me())}function mi(t){st||(st=!0,Qe()),ke(M.bH(e.selRectLineWidth,e.selRectLineWidth)),ke((M=yt.aV(S,t)).bH(e.selRectLineWidth,e.selRectLineWidth)),e.canSelectOnMouseMove&&Li(),Me()}function Li(){Zt();var t=M;switch(e.mouseSelection){case"selection2":e.canMultiSelect&&function(t){var i,o,s;for(Zt(),i=0;i<n.length;i++)o=e.isNode(s=n[i])?Et(s):re(s),t.lK(o)&&s.isSelectable&&s.setIsSelected(!0)}(t);break;case"selection":e.canMultiSelect&&function(t){var i,o,s;for(Zt(),i=0;i<n.length;i++)o=e.isNode(s=n[i])?Et(s):re(s),t.fb(o)&&s.isSelectable&&s.setIsSelected(!0)}(t)}}function Ai(t){lt||(lt=!0,Qe()),ke(M.bH(e.selRectLineWidth,e.selRectLineWidth)),ke((M=yt.aV(S,t)).bH(e.selRectLineWidth,e.selRectLineWidth)),Me()}Dt.dU=function(t,e,i,n){var o;return{fn:(o=function(t,e,i,n){var s,l,h,r,a;return s=[],l=null,h=null,r=null,a=null,{x:t,y:e,w:i,h:n,eB:function(o,d){var f,u,p,c,g;if(void 0!==d&&null!==d&&0!==d.width&&0!==d.height)for(f=new xt(t,e,i/2,n/2),u=new xt(t+i/2,e,i/2,n/2),p=new xt(t,e+n/2,i/2,n/2),c=new xt(t+i/2,e+n/2,i/2,n/2),f.fb(d)&&null!==l&&l.eB(o,d),u.fb(d)&&null!==h&&h.eB(o,d),p.fb(d)&&null!==r&&r.eB(o,d),c.fb(d)&&null!==a&&a.eB(o,d),g=0;g<s.length;g++)s[g].fd.fb(d)&&o.push(s[g])},cs:function(d,f){var u,p,c,g,x;if(u=new xt(t,e,i/2,n/2),p=new xt(t+i/2,e,i/2,n/2),c=new xt(t,e+n/2,i/2,n/2),g=new xt(t+i/2,e+n/2,i/2,n/2),x=null,u.lK(f)?(null===l&&(l=new o(u.left,u.top,u.width,u.height)),x=l):p.lK(f)?(null===h&&(h=new o(p.left,p.top,p.width,p.height)),x=h):c.lK(f)?(null===r&&(r=new o(c.left,c.top,c.width,c.height)),x=r):g.lK(f)&&(null===a&&(a=new o(g.left,g.top,g.width,g.height)),x=a),null!==x)return x.cs(d,f);s.push(d),d.fF=this},dS:function(t){var e,i;if(e=-1,null!==s){for(i=0;i<s.length;i++)if(s[i]===t){e=i;break}s.splice(e,1)}},ft:function(){null!==l&&l.ft(),null!==h&&h.ft(),null!==r&&r.ft(),null!==a&&a.ft(),s.length=0}}})(t,e,i,n),cs:function(t,e){this.fn.cs(t,e)},dS:function(t){null!==t.fF&&t.fF.dS(t)},ev:function(t){var e=[];return this.fn.eB(e,t),e},ft:function(){this.fn.ft()}}},St=function(t,e,i,n,o){var s=!1,l=[];this.kindOfItem="Node",this.index=-1,this.flow=null,this.fd=null,this.fF=null,this.x=t,this.y=e,this.w=i,this.h=n,this.text=void 0!==o?o:null,this.strokeStyle="#000",this.fillStyle="#fff",this.gradientFillStyle="#fff",this.textFillStyle="#000",this.lineWidth=1,this.shapeFamily="ellipse",this.polygon=null,this.drawShape=null,this.fillShape=null,this.pins=null,this.isSelectable=!0,this.isXSizeable=!0,this.isYSizeable=!0,this.isXMoveable=!0,this.isYMoveable=!0,this.isOutLinkable=!0,this.isInLinkable=!0,this.isContextHandle=!1,this.isShadowed=!1,this.image=null,this.textMargin={left:0,top:0,right:0,bottom:0},this.imageMargin={left:0,top:0,right:0,bottom:0},this.textPosition="centerMiddle",this.imagePosition="centerMiddle",this.font="12px Arial",this.textLineHeight=null,this.getIsSelected=function(){return s},this.setIsSelected=function(t){t!==s&&(s=t,we(this,Z))},this.getLinks=function(){return l},this.getLeft=function(){return this.x},this.setLeft=function(t){var e=Et(this);e.left=t,qt(this,e)},this.getTop=function(){return this.y},this.setTop=function(t){var e=Et(this);e.top=t,qt(this,e)},this.getWidth=function(){return this.w},this.setWidth=function(t){var e=Et(this);e.width=t,qt(this,e)},this.getHeight=function(){return this.h},this.setHeight=function(t){var e=Et(this);e.height=t,qt(this,e)},this.refresh=function(){Bt(this),Me()},this.clone=function(){var t=new St(this.x,this.y,this.w,this.h,this.text);return ve(t,this),t}},vt=function(t,n,o,s,l){var r=!1;this.kindOfItem="Link",this.index=-1,this.flow=null,this.fd=null,this.fF=null,this.org=t,this.dst=n,this.pinOrg=void 0===s?null:s,this.pinDst=void 0===l?null:l,this.font="12px Arial",this.text=void 0!==o?o:null,this.strokeStyle="#000",this.fillStyle="#fff",this.textFillStyle="#000",this.lineWidth=1,this.isStretchable=!0,this.isSelectable=!0,this.isContextHandle=!1,this.isShadowed=!1,this.isOrgPointAdjustable=!1,this.isDstPointAdjustable=!1,this.roundedCornerSize=0,this.isOrientedText=!1,this.isOpaque=!1,this.font="12px Arial",this.arrowDst=h,this.arrowOrg=null,this.lineStyle="polyline",this.orthoMargin=30,this.ij=!1,this.points=[],this.getIsSelected=function(){return r},this.setIsSelected=function(t){t!==r&&(r=t,we(this,Z))},this.getOrg=function(){return this.org},this.setOrg=function(t){!function(t,n){var o,s,l;if(t!==e.linkModel){if(i.aL()&&i.bG(new zt(e,t,t.org)),ie(t),null!==(s=t.org)){for(o=s.getLinks(),l=0;l<o.length&&o[l]!==t;l++);o.splice(l,1)}null!==n&&((o=n.getLinks()).push(t),t.org=n,null!==t.org.pins?(t.pinOrg<0||t.pinOrg>=t.org.pins.length)&&(t.pinOrg=0):t.pinOrg=-1,"database"===t.getLineStyle()?de(t):"orthogonal"===t.getLineStyle()&&fe(t),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh())}else t.org=n}(this,t)},this.getDst=function(){return this.dst},this.setDst=function(t){!function(t,n){var o,s,l;if(t!==e.linkModel){if(i.aL()&&i.bG(new Pt(e,t,t.dst)),ie(t),null!==(s=t.dst)){for(o=s.getLinks(),l=0;l<o.length&&o[l]!==t;l++);o.splice(l,1)}null!==n&&((o=n.getLinks()).push(t),t.dst=n,null!==t.dst.pins?(t.pinDst<0||t.pinDst>=t.dst.pins.length)&&(t.pinDst=0):t.pinDst=-1,"database"===t.getLineStyle()?de(t):"orthogonal"===t.getLineStyle()&&fe(t),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh())}else t.dst=n}(this,t)},this.getPinOrg=function(){return this.pinOrg},this.setPinOrg=function(t){le(this,t)},this.getPinDst=function(){return this.pinDst},this.setPinDst=function(t){he(this,t)},this.refresh=function(){ie(this),Me()},this.clone=function(){var t=new vt(this.org,this.dst,this.text,this.pinOrg,this.pinDst);return be(t,this),t},this.getLineStyle=function(){return this.lineStyle},this.setLineStyle=function(t){!function(t,n){t.lineStyle!==n&&(t!==e.linkModel?(i.aL()&&i.bG(new Ct(e,t,t.lineStyle)),t.lineStyle=n,("bezier"===t.lineStyle&&4!==t.points.length||"database"===t.lineStyle||"orthogonal"===t.lineStyle)&&ae(t),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh()):t.lineStyle=n)}(this,t)},this.getIsOrgPointAdjustable=function(){return this.isOrgPointAdjustable},this.setIsOrgPointAdjustable=function(t){!function(t,n){t.isOrgPointAdjustable!==n&&(t!==e.linkModel?(i.aL()&&i.bG(new At(e,t)),t.isOrgPointAdjustable=n,null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh()):t.isOrgPointAdjustable=n)}(this,t)},this.getIsDstPointAdjustable=function(){return this.isDstPointAdjustable},this.setIsDstPointAdjustable=function(t){!function(t,n){t.isDstPointAdjustable!==n&&(t!==e.linkModel?(i.aL()&&i.bG(new At(e,t)),t.isDstPointAdjustable=n,null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh()):t.isDstPointAdjustable=n)}(this,t)},this.addPoint=function(t,n){!function(t,n,o){i.aL()&&i.bG(new At(e,t)),ie(t),t.points.splice(t.points.length-1,0,{x:n,y:o}),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh()}(this,t,n)},this.removePoint=function(t){!function(t,n){i.aL()&&i.bG(new At(e,t)),ie(t),t.points.splice(n,1),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh()}(this,t)},this.clearPoints=function(){var t;t=this,i.aL()&&i.bG(new At(e,t)),ie(t),ae(t),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh()},this.countPoints=function(){return this.points.length},this.getPoint=function(t){return null===(e=this).points||t<0||t>e.points.length-1?null:{x:e.points[t].x,y:e.points[t].y};var e},this.setPoint=function(t,n,o){!function(t,n,o,s){null===t.points||s<0||s>t.points.length-1||0===s&&null===t.org.pins&&!t.isOrgPointAdjustable||s===t.points.length-1&&null===t.dst.pins&&!t.isDstPointAdjustable||(i.aL()&&i.bG(new At(e,t)),ie(t),function(t,e,i){null!==t.points&&(t.points[s]={x:n,y:o})}(t),null!==t.org.pins||t.isOrgPointAdjustable||pe(t),null!==t.dst.pins||t.isDstPointAdjustable||ue(t),t.refresh())}(this,t,n,o)}},bt=function(){this.aZ=null,this.group=-1,this.cN="AF_none",this.code="AF_none"},wt=function(t,e,i){var n,o,s,l;bt.call(),n=t.canvas.parentNode,o=0,s=0,(l=this).code="AF_nodeMoveAndSize",l.aZ=e,null!==n&&void 0!==n&&(o=n.scrollLeft,s=n.scrollTop),l.redo=function(){l.undo()},l.undo=function(){var e,h,r;h=0,r=0,null!==n&&void 0!==n&&(h=n.scrollLeft,r=n.scrollTop),e=Et(l.aZ),qt(l.aZ,i),Bt(l.aZ),te(l.aZ),t.refresh(),i=e,null!==n&&void 0!==n&&(n.scrollLeft=o,n.scrollTop=s,o=h,s=r)}},Mt=function(t,e){var i;bt.call(),(i=this).aZ=e,i.code="AF_nodeAdd",i.redo=function(){n.push(e),e.index=n.length-1,t.refresh()},i.undo=function(){e.getIsSelected()&&e.setIsSelected(!1),Bt(e),Vt(e.index),qe(),t.refresh()}},kt=function(t,e){var i;bt.call(),(i=this).aZ=e,i.code="AF_nodeRemove",i.redo=function(){Bt(e),Vt(e.index),qe(),t.refresh()},i.undo=function(){n.push(e),e.index=n.length-1,Bt(e),t.refresh()}},mt=function(t,e){var i;bt.call(),(i=this).aZ=e,i.code="AF_linkAdd",i.redo=function(){var i;n.push(e),e.index=n.length-1,ie(e),Ue(re(e)),i=e.dst,$t(e.org).push(e),$t(i).push(e),t.refresh()},i.undo=function(){e.getIsSelected()&&e.setIsSelected(!1),Vt(e.index),e.setOrg(null),e.setDst(null),t.refresh()}},Lt=function(t,e){var i;bt.call(),(i=this).aZ=e,i.code="AF_linkRemove",i.redo=function(){e.getIsSelected()&&e.setIsSelected(!1),Vt(e.index),e.setOrg(null),e.setDst(null),t.refresh()},i.undo=function(){var i;n.push(e),e.index=n.length-1,ie(e),Ue(re(e)),i=e.dst,e.org.getLinks().push(e),i.getLinks().push(e),t.refresh()}},At=function(t,e){var i,n,o,s;bt.call(),i=this,n=e.points.slice(),o=e.isOrgPointAdjustable,s=e.isDstPointAdjustable,i.aZ=e,i.code="AF_linkStretch",i.redo=function(){i.undo()},i.undo=function(){var i,l,h,r,a;i=e.lineWidth+t.handleSize,l=(l=re(e)).bH(i,i),h=e.points.slice(),e.points.splice(0,e.points.length),e.points=e.points.concat(n),n=h,r=e.isOrgPointAdjustable,a=e.isDstPointAdjustable,e.setIsOrgPointAdjustable(o),e.setIsDstPointAdjustable(s),o=r,s=a,ke(l),ie(e),t.refresh()}},zt=function(t,e,i){var n,o;bt.call(),(n=this).aZ=e,n.code="AF_org",n.redo=function(){n.undo()},n.undo=function(){o=e.org,e.setOrg(i),i=o,t.refresh()}},Pt=function(t,e,i){var n,o;bt.call(),(n=this).aZ=e,n.code="AF_dst",n.redo=function(){n.undo()},n.undo=function(){o=e.dst,e.setDst(i),i=o,t.refresh()}},mW=function(t,e,i){var n,o;bt.call(),(n=this).aZ=e,n.code="AF_pinOrg",n.redo=function(){n.undo()},n.undo=function(){o=e.pinOrg,e.setPinOrg(i),i=o,t.refresh()}},mL=function(t,e,i){var n,o;bt.call(),(n=this).aZ=e,n.code="AF_pinDst",n.redo=function(){n.undo()},n.undo=function(){o=e.pinDst,e.setPinDst(i),i=o,t.refresh()}},Ht=function(t){var e,i;bt.call(),e=this,i=n.slice(),e.code="AF_zOrder",e.redo=function(){e.undo()},e.undo=function(){var e,o;for(o=n.slice(),n=i.slice(),i=o,t.refresh(),e=0;e<n.length;e++)n[e].index=e}},Ct=function(t,e,i){var n,o;bt.call(),n=this,o=e.points.slice(),n.aZ=e,n.code="AF_lineStyle",n.redo=function(){n.undo()},n.undo=function(){var s,l,h,r;s=n.aZ.lineWidth+t.handleSize,l=(l=re(n.aZ)).bH(s,s),r=n.aZ.lineStyle,h=n.aZ.points.slice(),n.aZ.lineStyle=i,n.aZ.points.splice(0,n.aZ.points.length),n.aZ.points=e.points.concat(o),i=r,o=h,ke(l),n.aZ.refresh()}},TaskManager=function(){var t=[],e=-1,i=-1,n="AF_none",o=!1,s=!1,l=!1,h=this;function r(){var i,n;if(h.canUndoRedo&&h.eW()){for(l=!0,_e(),i=t[e],e--,i.undo();h.eW()&&(n=t[e]).group===i.group;)e--,n.undo();Ee(),l=!1}}function a(t){return"AF_none"!==t.cN?t.cN:t.code}this.canUndoRedo=!0,this.undoLimit=0,this.skipUndo=!1,this.undoCode=function(){return h.eW()?a(t[e]):"AF_none"},this.redoCode=function(){return h.eV()?a(t[e+1]):"AF_none"},this.undoItem=function(){return h.eW()?t[e].aZ:null},this.redoItem=function(){return h.mU()?t[e+1].aZ:null},this.canUndo=function(){return h.eW()},this.canRedo=function(){return h.eV()},this.undo=function(){r()},this.redo=function(){!function(){var i,n;if(h.canUndoRedo&&h.eV()){for(l=!0,_e(),(i=t[++e]).redo();h.eV();){if((n=t[++e]).group!==i.group){e--;break}n.redo()}Ee(),l=!1}}()},this.beginAction=function(t){!function(t){t.length>=3&&"AF_"===t.substr(0,3)||function(t){o||(o=!0,i++,n=t)}(t)}(t)},this.endAction=function(){o&&(o=!1,n="AF_none")},this.clear=function(){t=[],e=-1,i=-1,o=!1,s=!1},this.addToLastAction=function(){o=!0},this.submitTask=function(t){h.bG(t)},this.removeLastTask=function(){!function(){for(r();e+1<t.length;)t.splice(t.length-1,1)}()},this.mI=function(){return e+1},this.aL=function(){return h.canUndoRedo&&!h.skipUndo&&!l},this.eW=function(){return!!h.canUndoRedo&&e>=0},this.eV=function(){return!!h.canUndoRedo&&e<t.length-1},this.dN=function(t){o||(s=!0,i++,n=t)},this.cV=function(){o||(s=!1,n="AF_none")},this.fq=function(){return s||o},this.bG=function(o){var s;if(null!==o&&(t.splice(++e,t.length-1-e,o),h.fq()||i++,o.group=i,o.cN=n,h.undoLimit>0&&e>=h.undoLimit&&(s=t[0].group)!==i))for(t.iV(0,1),e--;e>0&&t[0].group===s;)t.iV(0,1),e--}},e=this,i=new TaskManager,n=[],s=[],l=null,h=[[0,0],[-10,-4],[-10,4]],r={none:0,add:1,del:2,first:3,last:4,change:5},a={ih:0,up:1,fI:2,left:3,right:4,gQ:5,down:6,fX:7},d={items:0,nodes:1,links:2,hX:3,jQ:4,hZ:5},f=8,u=8,p=100,c=20,g=20,x=[0,0],b=null,w=null,M=null,k=new xt(0,0,0,0),m=!1,L=!1,A=0,z=0,P=!1,H=[],C=null,O=null,D=null,I=null,j=null,W=null,F=t.width,N=t.height,R=35,Z=!1,V=0,Y=0,X=!1,_=!1,E=!1,B=!1,q=!1,U=!1,K=!1,Q=!1,J=!1,$=0,cA=!0,tt=!1,et=!1,it=!1,nt=!1,ot=!1,st=!1,lt=!1,ht=!1,rt="none",at="none",ft=!1,ut=null,gt=new function(){var t,e,i,n,o,s;function l(t,e,i){var n,o,s,l;for(o=!0,n=0;n<i.length;n++)if(s=t,l=e,i[n].bH(-1,-1).fb(yt.aV(s,l))){o=!1;break}return o}function h(t,e,i){var n;switch(i){case"left":n={x:e.left,y:t.y};break;case"top":n={x:t.x,y:e.top};break;case"right":n={x:e.left+e.width,y:t.y};break;case"bottom":n={x:t.x,y:e.top+e.height}}return n}function r(t,e){var i="none";return t.x===e.x?i=t.y>=e.y?"bottom":"top":t.y===e.y&&(i=t.x>=e.x?"right":"left"),i}function a(t,e){var i,n,o,s,l,h;return i=Et(t),n=Math.abs(e.x-i.left),o=Math.abs(e.x-(i.left+i.width)),s=Math.abs(e.y-i.top),l=Math.abs(e.y-(i.top+i.height)),(h=Math.min(Math.min(Math.min(n,o),s),l))===n?"left":h===o?"right":h===s?"top":"bottom"}function d(t,e){switch(t){case"left":i={x:e.left+e.width,y:e.top},n={x:e.left+e.width,y:e.top+e.height};break;case"top":i={x:e.left,y:e.top+e.height},n={x:e.left+e.width,y:e.top+e.height};break;case"right":i={x:e.left,y:e.top},n={x:e.left,y:e.top+e.height};break;case"bottom":i={x:e.left,y:e.top},n={x:e.left+e.width,y:e.top}}}function f(t,e){switch(t){case"left":i={x:e.left,y:e.top},n={x:e.left,y:e.top+e.height};break;case"top":i={x:e.left,y:e.top},n={x:e.left+e.width,y:e.top};break;case"right":i={x:e.left+e.width,y:e.top},n={x:e.left+e.width,y:e.top+e.height};break;case"bottom":i={x:e.left,y:e.top+e.height},n={x:e.left+e.width,y:e.top+e.height}}}function u(e,o,s,l){return f(t,o),s.bf(i)?n:s.bf(n)?i:yt.dH(i,e)<=yt.dH(n,e)?i:n}function p(t,h,r,a){var d,u;return f(e,a),s=n,d=l(t,o=i,[r,a]),u=l(t,s,[r,a]),d?u?a.bf(o)?s:a.bf(s)?o:yt.dH(o,h)<=yt.dH(s,h)?o:s:o:u?s:{x:void 0,y:void 0}}function c(t,e,i){return!!(l(t,{x:e.left,y:e.top},i)||l(t,{x:e.left+e.width,y:e.top},i)||l(t,{x:e.left,y:e.top+e.height},i)||l(t,{x:e.left+e.width,y:e.top+e.height},i))}function g(t,e){return Et(t).bH(e,e)}this.lh=function(x,y,S,v,b){var w,M,k,m,L,A,z,P,H=[],C=!1,O=!1,D=null,I=null,j=g(x,b),T=g(y,b),W=j.af(),F=T.af();if(void 0!==S&&null!==S&&null!==x.pins||(C=!0,D=x.pins,x.pins=[[0,50],[50,0],[100,50],[50,100]],S=Math.abs(W.x-F.x)<Math.abs(W.y-F.y)?F.y>W.y?3:1:F.x>W.x?2:0),void 0!==v&&null!==v&&null!==y.pins||(O=!0,I=y.pins,y.pins=[[0,50],[50,0],[100,50],[50,100]],v=Math.abs(W.x-F.x)<Math.abs(W.y-F.y)?W.y<F.y?1:3:W.x<F.x?0:2),w=h(w=Te(x,S),j,t=a(x,w)),M=h(M=Te(y,v),T,e=a(y,M)),H.push(w),T.bf(k=w)||j.bf(M))H.push(M);else for(;;){if(l(k,M,[j,T])){H.push(M),k=M;break}if(void 0!==(L=p(k,M,j,T)).x){H.push(L),H.push(M),k=M;break}if(k!==w){if(f(e,T),o=i,s=n,d(e,T),z=l(k,i,[j,T]),P=l(k,n,[j,T]),z&&P){if(j.bf(i)){H.push(n),j.bf(s)?(H.push(i),H.push(o)):H.push(s),H.push(M),k=M;break}if(j.bf(n)){H.push(i),j.bf(o)?(H.push(n),H.push(s)):H.push(o),H.push(M),k=M;break}if(yt.dH(i,M)<=yt.dH(n,M)){H.push(i),j.bf(o)?(H.push(n),H.push(s)):H.push(o),H.push(M),k=M;break}H.push(n),j.bf(s)?(H.push(i),H.push(o)):H.push(s),H.push(M),k=M;break}if(z){H.push(i),j.bf(o)?(H.push(n),H.push(s)):H.push(o),H.push(M),k=M;break}H.push(n),j.bf(s)?(H.push(i),H.push(o)):H.push(s),H.push(M),k=M;break}m=u(M,j,T),H.push(m),c(k=m,T,[j])||(d(t,j),H.push(n),c(k=n,T,[j])||(H.push(i),k=i))}return function(i,n,o,s){var l={x:0,y:0},h={x:0,y:0};switch(t){case"left":l={x:i.x+s,y:i.y};break;case"top":l={x:i.x,y:i.y+s};break;case"right":l={x:i.x-s,y:i.y};break;case"bottom":l={x:i.x,y:i.y-s}}switch(e){case"left":h={x:n.x+s,y:n.y};break;case"top":h={x:n.x,y:n.y+s};break;case"right":h={x:n.x-s,y:n.y};break;case"bottom":h={x:n.x,y:n.y-s}}o.splice(0,0,l),o.push(h)}(w,M,H=function(i,n){var o,s,h,a,d,f,u,p,c;for(p=[],c=0,o=0;o<i.length;o++)if(o>=c){for(h=i.length-1;h>o;h--)if(l(i[o],i[h],n)){c=h;break}p.push(i[o])}for(s=0;s<p.length-1;s++)if(p[s].x!==p[s+1].x&&p[s].y!==p[s+1].y){if(a=0===s?t:r(p[s],p[s-1]),d=s===p.length-2?e:r(p[s+1],p[s+2]),!("left"!==a&&"right"!==a||"left"!==d&&"right"!==d))return f=Math.min(p[s].x,p[s+1].x)+Math.abs(p[s].x-p[s+1].x)/2,p.splice(s+1,0,{x:f,y:p[s].y}),p.splice(s+2,0,{x:f,y:p[s+2].y}),p.length-1>s+3&&p.splice(s+3,1),p;if(!("top"!==a&&"bottom"!==a||"top"!==d&&"bottom"!==d))return u=Math.min(p[s].y,p[s+1].y)+Math.abs(p[s].y-p[s+1].y)/2,p.splice(s+1,0,{x:p[s].x,y:u}),p.splice(s+2,0,{x:p[s+2].x,y:u}),p.length-1>s+3&&p.splice(s+3,1),p;if(!("left"!==a&&"right"!==a||"top"!==d&&"bottom"!==d))return p.splice(s+1,0,{x:p[s+1].x,y:p[s].y}),p;if(!("top"!==a&&"bottom"!==a||"left"!==d&&"right"!==d))return p.splice(s+1,0,{x:p[s].x,y:p[s+1].y}),p}return p}(H,[j,T]),b),O&&(y.pins=I),C&&(x.pins=D),function(t,e){var i,n,o,s,l,h,r,a,d;if(!(e.length<=2)){for(i=!0;i;)for(i=!1,d=1;d<e.length-1;d++)if(s=e[d+1],(n=e[d-1]).y===(o=e[d]).y&&o.y===s.y||n.x===o.x&&o.x===s.x){e.splice(d,1),i=!0;break}for(d=0;d<e.length;d++)t.push(e[d]);2===e.length&&((l=t[0]).y===(a=t[1]).y?(h={x:l.x+(a.x-l.x)/2,y:l.y},r={x:a.x-(a.x-l.x)/2,y:a.y}):(h={x:l.x,y:l.y+(a.y-l.y)/2},r={x:a.x,y:a.y-(a.y-l.y)/2}),t.splice(1,0,h),t.splice(2,0,r))}}(A=[],H),A}},this.canvas=t,this.nodeModel=new St(0,0,0,0,""),this.linkModel=new vt(null,null,""),this.isFixedSize=!1,this.canDrawNode=!0,this.canDrawLink=!0,this.canMoveNode=!0,this.canSizeNode=!0,this.canStretchLink=!0,this.canMultiLink=!0,this.canReflexLink=!0,this.canChangeOrg=!0,this.canChangeDst=!0,this.canMultiSelect=!0,this.canDragScroll=!0,this.canSelectOnMouseMove=!0,this.canSendSelectionChangedEvent=!0,this.canShowContextHandle=!0,this.mouseSelection="none",this.hitArea="outSide",this.taskManager=i,this.shadowOffsetX=5,this.shadowOffsetY=5,this.shadowBlur=2,this.shadowColor="rgba(128, 128, 192, 0.5)",this.linkSelectionAreaWidth=6,this.removePointDistance=6,this.zoom=1,this.gridSizeX=16,this.gridSizeY=16,this.gridSnap=!1,this.gridDraw=!1,this.gridStrokeStyle="rgb(192, 192, 192)",this.fillStyle="#fff",this.ownerDraw=null,this.selRectFillStyle="rgba(224, 224, 224, 0.3)",this.selRectStrokeStyle="gray",this.selRectLineWidth=1,this.bezierSelectionLinesStrokeStyle="navy",this.handleSize=6,this.handleGradientColor1="white",this.handleGradientColor2="lightgray",this.handleStrokeStyle="black",this.contextHandleSize=20,this.contextHandleStrokeStyle="navy",this.contextHandleGradientColor1="white",this.contextHandleGradientColor2="lightblue",this.pinSize=8,this.pinGradientColor1="white",this.pinGradientColor2="navy",this.pinStrokeStyle="white",this.centralPinGradientColor1="white",this.centralPinGradientColor2="white",this.centralPinStrokeColor="black",this.xCustomOffset=0,this.yCustomOffset=0,this.refresh=function(){ke(null),Be(),Me()},this.useQuadtree=function(t){cA!==t&&(cA=t,cA&&jt())},this.getItems=function(){return n},this.getSelectedItems=function(){return s},this.getHitItem=function(){return l},this.addNode=function(t,e,i,n,o){return Ft(t,e,i,n,o)},this.addLink=function(t,e,i,n,o){return Gt(t,e,i,n,o)},this.removeNode=function(t){Nt(t)},this.removeLink=function(t){Rt(t)},this.deleteSel=function(){!function(){var t,e,n;if(0!==s.length){for(n=!1,i.aL()&&((n=i.fq())||i.dN("AF_del")),_e(),t=s.length-1;t>=0;t--)Wt(e=s[t])&&Rt(e);for(t=s.length-1;t>=0;t--)Tt(e=s[t])&&Nt(e);Ee(),i.aL()&&(n||i.cV(),i.cV())}}()},this.clear=function(){!function(){var t,e,i;if(0!==n.length){for(_e(),i=[],t=0;t<n.length;t++)Tt(n[t])&&i.push(n[t]);for(e=i.length-1;e>=0;e--)Nt(i[e]);Ee()}}()},this.selectAll=function(){!function(){var t,e;for(_e(),t=0;t<n.length;t++)(e=n[t]).getIsSelected()||e.setIsSelected(!0);Ee()}()},this.unselectAll=function(){Zt()},this.beginUpdate=function(){_e()},this.endUpdate=function(){Ee()},this.invalidateRect=function(t,e,i,n){ke(new xt(t,e,i,n))},this.isMovingNode=function(){return ot},this.isCreatingNode=function(){return tt},this.isCreatingLink=function(){return et},this.isStretchingLink=function(){return it},this.isResizingNode=function(){return nt},this.isSelecting=function(){return st},this.isZooming=function(){return lt},this.isPanning=function(){return ht},this.setSelChangedFlag=function(t){X=t},this.isSelChanged=function(){return X},this.isNode=function(t){return Tt(t)},this.isLink=function(t){return Wt(t)},this.sendToBack=function(){!function(){var t,o,l,h;for(i.aL()&&i.bG(new Ht(e)),t=0;t<s.length;t++)for(n.splice(l=(h=s[t]).index,1),n.splice(0,0,h),o=0;o<s.length;o++)o!==t&&s[o].index<l+1&&s[o].index++;for(t=0;t<n.length;t++)n[t].index=t;for(t=0;t<s.length;t++)(h=s[t]).refresh()}()},this.bringToFront=function(){!function(){var t,o,l,h;for(i.aL()&&i.bG(new Ht(e)),t=0;t<s.length;t++)for(n.splice(l=(h=s[t]).index,1),n.push(h),o=0;o<s.length;o++)o!==t&&s[o].index>l-1&&s[o].index--;for(t=0;t<n.length;t++)n[t].index=t;for(t=0;t<s.length;t++)(h=s[t]).refresh()}()},this.zoomRectangle=function(t,e,i,n){Ke(new xt(t,e,i,n))},this.getXExtent=function(){return k.width},this.getYExtent=function(){return k.height},function(t){t.addEventListener("ready",$e,!1),t.addEventListener("mousedown",ni,!1),t.addEventListener("mousemove",oi,!1),t.addEventListener("mouseup",si,!1),t.addEventListener("touchstart",ti,!1),t.addEventListener("touchmove",ei,!1),t.addEventListener("touchend",ii,!1),cA&&jt()}(this.canvas)}};